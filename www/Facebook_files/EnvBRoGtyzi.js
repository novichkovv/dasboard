/*!CK:487432823!*//*1460492293,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["xrW\/y"]); }

__d("TextWithEntitiesMetadataType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NONE:0,CONCEPT:1};},null);
__d('EmployeeLinkMatcher',['CurrentUser'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new RegExp('^[\\s.,:]'),i=new RegExp('(?:[\\s.,:]|^)([BDTP]\\d{4,})(?:[\\s.,:?]|$)','im'),j=function(m){if(!c('CurrentUser').isEmployee())return null;var n=i.exec(m);if(n==null)return null;return {lnk:n[1],idx:n.index+(h.exec(n[0])?1:0)};},k=function(m){var n=c('CurrentUser').isEmployee()&&i.exec(m)!=null;return n;},l={match:j,isMatch:k};f.exports=l;},null);
__d('EmployeeLinkRanges',['EmployeeLinkMatcher'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={PHABRICATOR_PREFIX:'https://phabricator.fb.com/',TASKS_PREFIX:'https://our.intern.facebook.com/intern/tasks/?t=',BUSINESS_PREFIX:'https://our.intern.facebook.com/intern/business/?q=',get:function(i){var j=arguments.length<=1||arguments[1]===undefined?0:arguments[1],k=i.substr(j),l=c('EmployeeLinkMatcher').match(k);if(!l)return [];var m=l.lnk;j+=l.idx;var n='';switch(m[0].toLowerCase()){case 'd':case 'p':n=this.PHABRICATOR_PREFIX+m.toUpperCase();break;case 't':n=this.TASKS_PREFIX+m.substr(1);break;case 'b':n=this.BUSINESS_PREFIX+m.substr(1);break;default:return [];}var o=m.length,p=[{offset:j,length:o,entity:{url:n}}];return p.concat(this.get(i,j+o));}};f.exports=h;},null);
__d('MercuryMessageBody.react',['cx','fbt','BootloadedComponent.react','EmoticonsList','EmployeeLinkMatcher','EmployeeLinkRanges','JSResource','Link.react','MercuryConfig','MessengerSupportedEmoji','P2PTriggersUtils','ReactComponentWithPureRenderMixin','React','SupportedEmoji','TextWithEntities.react','TextWithEntitiesMetadataType','URI','URLMatcher','cancelAnimationFrame','emptyFunction','getURLRanges','ifRequired','requestAnimationFrame','shouldAddMRefParam'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=function(){k=c('emptyFunction');c('ifRequired')('ChatAppActions',function(m){m.setInitialDisplayDone();});},l=c('React').createClass({displayName:'MercuryMessageBody',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{body:j.string,customLike:j.object,metaRanges:j.array,ranges:j.array,threadID:j.string},getInitialState:function(){return {richText:false};},_shouldRenderP2PTriggers:false,componentDidMount:function(){this._raf=c('requestAnimationFrame')(this.setIsRichText);},targetBlankLinkInterpolator:function(m,n){if(n.className)return c('React').createElement('span',{className:n.className},m);if(n.entity&&n.entity.url){var o=new (c('URI'))(n.entity.url.replace(/#+$/,''));if(c('shouldAddMRefParam')(o))o.addQueryData({__mref:'message_bubble'});return (c('React').createElement(c('Link.react'),{href:{url:o.toString(),shimhash:n.entity.shimhash},s:n.entity.s,target:'_blank'},m));}else if(!n.entity)switch(n.type){case c('TextWithEntitiesMetadataType').NONE:return (c('React').createElement('span',{className:"_2y9",title:JSON.stringify(n.data)},m));default:return m;}},setIsRichText:function(){delete this._raf;var m=this.props,n=m.body,o=m.ranges,p=m.metaRanges;n=n||'';this._shouldRenderP2PTriggers=!!(this.props.threadID&&c('P2PTriggersUtils').canSeeTriggers(this.props.threadID)&&c('P2PTriggersUtils').getMatches(n));if(o&&o.length||p&&p.length||c('EmoticonsList').noncapturingRegexp.test(n)||c('SupportedEmoji').findEmoji(n)||c('URLMatcher').match(n)||c('EmployeeLinkMatcher').isMatch(n)||this._shouldRenderP2PTriggers||c('MercuryConfig').MessengerNewEmojiGK&&c('MessengerSupportedEmoji').findEmoji(n)){this.setState({richText:true},k);}else k();},componentWillUnmount:function(){this._raf&&c('cancelAnimationFrame')(this._raf);},render:function(){var m=this.props.body||'';if(m.startsWith('?OTR'))return (c('React').createElement('span',{className:"_89h"},i._("[\u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435]")));m=m.replace(/\s+$/,'');if(m.length===0)return null;if(!this.state.richText)return c('React').createElement('span',{className:this.props.className},m);var n=this.props.ranges;if(n==undefined)n=c('getURLRanges')(m);if(n==undefined){n=c('EmployeeLinkRanges').get(m);}else{n=n.concat(c('EmployeeLinkRanges').get(m));n=n.filter(function(r){return r!=undefined;});}var o={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,metaRanges:this.props.metaRanges,ranges:n,renderEmoji:true,renderEmoticons:true,text:m},p=c('React').createElement(c('TextWithEntities.react'),o);if(this._shouldRenderP2PTriggers){return (c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:p,bootloadLoader:c('JSResource')('TextWithEntitiesAndP2P.react')},o,{threadID:this.props.threadID})));}else if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEntitiesModule){var q=c('MercuryConfig').MessengerTextWithEntitiesModule;return (c('React').createElement(q,o));}else return p;}});f.exports=l;},null);
__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.which===c('Keys').RETURN&&(i.getModifierState('Shift')||i.getModifierState('Alt')||i.getModifierState('Control'));}f.exports=h;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new RegExp(c('EmoticonsList').regexp.source,'g');function i(j,k){var l=k.getAnchorKey(),m=k.getAnchorOffset(),n=j.getBlockForKey(l),o=c('getTextAfterNearestEntity')(n,m),p,q;while(q!==null){q=h.exec(o);if(q!==null)p=q;}if(!p)return j;var r=p[1];if(!r&&m!==o.length)return j;var s=p[2],t=m-o.length,u=t+p.index+p[1].length,v=j.getBlockMap().set(l,c('applyEmoticonToContentBlock')(n,s,u));m-=s.length-1;return j.merge({blockMap:v,selectionBefore:k,selectionAfter:k.merge({anchorOffset:m,focusOffset:m})});}f.exports=i;},null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;},null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c('applyEmoticonToContentState')(j,k);if(l===j)return i;var m=c('DraftModifier').splitBlock(l,l.getSelectionAfter());return c('EditorState').push(i,m,'split-block');}f.exports=h;},null);
__d('LoadOnRender.react',['React','createCancelableFunction'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.defaultProps={forcePlaceholder:false};function j(k){'use strict';i.constructor.call(this,k);this.$LoadOnRender1=this.$LoadOnRender1.bind(this);this.state={Component:null,cancelableOnComponentLoad:c('createCancelableFunction')(this.$LoadOnRender1)};}j.prototype.$LoadOnRender1=function(k){'use strict';this.setState({Component:k});};j.prototype.componentWillMount=function(){'use strict';this.props.loader(this.state.cancelableOnComponentLoad);};j.prototype.componentWillUnmount=function(){'use strict';this.state.cancelableOnComponentLoad.cancel();};j.prototype.render=function(){'use strict';var k=this.state.Component;if(!k||this.props.forcePlaceholder)return this.props.placeholder;return c('React').cloneElement(this.props.component,{LazyLoadedComponent:k});};f.exports=j;},null);
__d('BootloadOnRender.react',['Bootloader','LoadOnRender.react','React'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.$BootloadOnRender1=this.$BootloadOnRender1.bind(this);}j.prototype.$BootloadOnRender1=function(k){'use strict';c('Bootloader').loadModules.call(c('Bootloader'),[this.props.loader.getModuleId()],k);};j.prototype.render=function(){'use strict';return (c('React').createElement(c('LoadOnRender.react'),{placeholder:this.props.placeholder,loader:this.$BootloadOnRender1,component:this.props.component}));};f.exports=j;},null);
__d('LazyComponent.react',['React'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.defaultProps={LazyLoadedComponent:function(){return null;}};j.prototype.render=function(){'use strict';var k=this.props,l=k.LazyLoadedComponent,m=babelHelpers.objectWithoutProperties(k,['LazyLoadedComponent']);return c('React').createElement(l,m);};function j(){'use strict';h.apply(this,arguments);}f.exports=j;},null);
__d('ChatAnimatedGifs',['URI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={shouldHideBody:function(i){if(!i.has_attachment)return false;for(var j=0;j<i.attachments.length;j++){var k=i.attachments[j];if(k.preview_url){var l=h.getRawUrlFromSafeUrl(k.preview_url);if(i.body==l)return true;}}return false;},getRawUrlFromSafeUrl:function(i){return new (c('URI'))(i).getQueryData().url;}};f.exports=h;},null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(i,j){this._userID=i;this._logger=c('JSLogger').create('blackbird');this._getState=function(){if(c('ChatVisibility').isOnline())return c('PresencePrivacy').allows(this._userID)?h.NORMAL:h.BLOCKED;return h.OFFLINE;};this._togglePrivacy=function(){var l=this._getState();switch(this._getState()){case h.OFFLINE:if(c('ChatVisibility').isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});c('ChatVisibility').goOnline(function(){if(!c('PresencePrivacy').allows(this._userID)){if(this._getState()!==h.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case h.BLOCKED:c('PresencePrivacy').allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case h.NORMAL:c('PresencePrivacy').disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var k=function(){j&&j(this._getState());}.bind(this);k();this._subscribeToken=c('PresencePrivacy').subscribe('privacy-changed',k);};h.OFFLINE='offline';h.BLOCKED='blocked';h.NORMAL='normal';Object.assign(h.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&c('PresencePrivacy').unsubscribe(this._subscribeToken);}});f.exports=h;},null);
__d('ChatDateBreak.react',['cx','React','formatDate','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatDateBreak',propTypes:{date:i.instanceOf(Date).isRequired},shouldComponentUpdate:function(k){return this.props.date.getTime()!==k.date.getTime();},render:function(){var k=c('formatDate')(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (c('React').createElement('time',{className:c('joinClasses')(this.props.className,"_5w-5")},c('React').createElement('span',{className:"_5w-6"},k)));}});f.exports=j;},null);
__d('ChatAttachmentProgressBar.react',['cx','Animation','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=34,k=c('React').createClass({displayName:'ChatAttachmentProgressBar',propTypes:{ephemeralTTLMode:i.number.isRequired,timestamp:i.number.isRequired,isMessageAuthor:i.bool},componentDidMount:function(){if(!this.refs.progressBar)return;var l=j,m=this.props.ephemeralTTLMode,n=l/m*(Date.now()-this.props.timestamp),o=this._getRemainingTime();if(o>0&&n<l){var p=this.props.isMessageAuthor?'left':'right';new (c('Animation'))(this.refs.progressBar).from(p,n).to(p,l).duration(o).go();}},_getRemainingTime:function(){return this.props.ephemeralTTLMode-(Date.now()-this.props.timestamp);},render:function(){return (c('React').createElement('a',{className:"_4yo"},c('React').createElement('span',{className:"_1gxq"}),c('React').createElement('span',{className:"_1gxr",ref:'progressBar'},c('React').createElement('span',{className:"_4yu"}))));}});f.exports=k;},null);
__d('ChatProgressBar.react',['cx','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=2000,k=250,l=c('React').createClass({displayName:'ChatProgressBar',_timer:null,propTypes:{isMessageAuthor:i.bool,onDone:i.func,setExpiredAnimation:i.func,timestamp:i.number.isRequired,ttl:i.number.isRequired},getInitialState:function(){return {percentage:this._getRemainingPercentage()};},componentDidMount:function(){if(this._getRemainingTime()>0){this._animateProgressBar();}else this.props.setExpiredAnimation&&this.props.setExpiredAnimation();},componentWillUnmount:function(){this._timer&&clearTimeout(this._timer);},render:function(){return (c('React').createElement('div',{className:"_3pcc"+(this._getRemainingTime()<0?' '+"_3pcd":''),ref:'item',style:{width:this.state.percentage.toString()+'%'}}));},_getRemainingTime:function(){return this.props.ttl-(Date.now()-this.props.timestamp)-j;},_getRemainingPercentage:function(){return 100-(Date.now()-this.props.timestamp)/(this.props.ttl-j)*100;},_animateProgressBar:function(){this._timer=setInterval(function(){if(this.isMounted())this.setState({percentage:this._getRemainingPercentage()});if(this._getRemainingTime()<0){clearTimeout(this._timer);this.props.onDone&&this.props.onDone();}}.bind(this),k);}});f.exports=l;},null);
__d('EmojiOnlyMessage.react',['cx','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'EmojiOnlyMessage',propTypes:{sourceURIs:i.arrayOf(i.shape({emoji:i.any,type:i.string.isRequired,title:i.string,url:i.string.isRequired})).isRequired},render:function(){var k=this.props.sourceURIs,l=0,m=k.map(function(n){l++;if(n.emoji)return c('React').createElement('span',{key:l,title:n.title},n.emoji);return c('React').createElement('span',{className:"_5qi2",key:l,style:{backgroundImage:'url('+n.url+')'},title:n.title});});return (c('React').createElement('div',{className:this.props.className,tabIndex:'0'},m));}});f.exports=j;},null);
__d('MessageBubbleMixin',['DOMDimensions','ReactDOM'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=2,i={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(j){if(j.maxWidth!==this.props.maxWidth||j.body!==this.props.body||!j.attachments&&this.props.attachments)this._restyleBubble(j);},_restyleBubble:function(j){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var k=c('ReactDOM').findDOMNode(this.refs.bubble);if(j.maxWidth!==this.props.maxWidth||c('DOMDimensions').getElementDimensions(k).width>this.props.maxWidth){var l=this.props.maxWidth;this.setState({bubbleWidth:l},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var j=c('ReactDOM').findDOMNode(this.refs.bubble),k=c('DOMDimensions').getElementDimensions(j).width,l=c('ReactDOM').findDOMNode(this.refs.content),m=l?c('DOMDimensions').getElementDimensions(l).width+c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.contentWrapper),'width',true,false,false):0,n=m+h;if(m>0&&n<this.props.maxWidth&&k-n-this.getBoxWidth()>0)this.setState({bubbleWidth:n});}};f.exports=i;},null);
__d('messengerCustomColorUtils',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j,k){k=k||{};k.backgroundColor=j;return k;}function i(j,k){k=k||{};k.borderColor=j;return k;}f.exports={customBubbleStyle:h,customChatBubbleStyle:i};},null);
__d('ChatBubble.react',['cx','Animation','ChatProgressBar.react','DOMDimensions','EmojiLikeUtils','EmojiOnlyMessage.react','MercuryAttachment','MercuryMessageBody.react','MessageBubbleMixin','MessagingGiftWrap.react','React','ReactDOM','joinClasses','messengerCustomColorUtils'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=1000,k=c('React').createClass({displayName:'ChatBubble',_boxWidth:0,mixins:[c('MessageBubbleMixin')],propTypes:{attachments:i.node,body:i.string,customColor:i.string,customLike:i.object,isEmojiLike:i.bool,isGiftWrapped:i.bool,isMessageAuthor:i.bool,maxWidth:i.number.isRequired,metaRanges:i.array,onUnwrap:i.func,ranges:i.array,threadID:i.string,timestamp:i.number,ttl:i.number},getInitialState:function(){return {emojis:undefined,ephemeralExpiring:false,ephemeralExpired:false};},componentDidMount:function(){if(this.props.attachments&&!this.props.isEmojiLike)return;if(!this.props.emojis){var l=this.props.body||'',m=c('EmojiLikeUtils').richContent(l);if(m)this.setState({emojis:m});}},render:function(){var l=this.props.body||'',m=null;if(this.props.customColor&&!this.state.emojis&&!this._isEpehmeralStylePreferred())m=c('messengerCustomColorUtils').customChatBubbleStyle(this.props.customColor);return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')("_5w1r"+(this._isEpehmeralStylePreferred()?' '+"_4gx-":'')+(this.state.ephemeralExpiring?' '+"_1xti":'')+(this.state.ephemeralExpired?' '+"_1xtj":'')+(!!m?' '+"_16dq":'')+(!this.state.emojis?' '+"_3_om":'')+(!!this.state.emojis?' '+"_31xx":''),this.props.className),ref:'bubble',style:babelHelpers['extends']({},m,{maxWidth:this.props.maxWidth,width:this.state.emojis?null:this.state.bubbleWidth,wordWrap:l.length>=15?'break-word':'inherit'})}),this._renderProgressBar(),c('React').createElement('div',{className:"_4gx_",ref:'inner'},this._renderContent(),this.props.attachments),this.props.isGiftWrapped?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:this.props.onUnwrap}):null));},_renderContent:function(){if(!this.props.body||this.props.isEmojiLike)return null;var l={};if(this.state.emojis){var m=c('EmojiLikeUtils').getSourceURIs(this.state.emojis),n=c('React').createElement(c('EmojiOnlyMessage.react'),{sourceURIs:m});}else{n=c('React').createElement(c('MercuryMessageBody.react'),{body:this.props.body,ranges:this.props.ranges,metaRanges:this.props.metaRanges,threadID:this.props.threadID,customLike:this.props.customLike});if(this.props.customColor)l=c('messengerCustomColorUtils').customBubbleStyle(this.props.customColor,l);}return (c('React').createElement('div',{className:"_d97"+(!!this.state.emojis?' '+"_31xy":''),ref:'contentWrapper',style:l},c('React').createElement('span',{className:"_5yl5",ref:'content'},n)));},_isEpehmeralStylePreferred:function(){if(!this.props.ttl)return false;if(!this.props.attachments)return true;return this.props.attachments.props.attachments.every(function(l){return c('MercuryAttachment').isEphemeralTextStyle(l);});},_onProgressBarAnimationDone:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});new (c('Animation'))(this.refs.inner).to('opacity',0).duration(j).go();}},_setExpiredAnimation:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});this.setState({ephemeralExpired:true});}},_renderProgressBar:function(){if(!this.props.timestamp||!this.props.ttl||!this._isEpehmeralStylePreferred()||this.state.emojis&&this.state.emojis.length>0)return null;return (c('React').createElement(c('ChatProgressBar.react'),{ttl:this.props.ttl,timestamp:this.props.timestamp,isMessageAuthor:this.props.isMessageAuthor,onDone:this._onProgressBarAnimationDone,setExpiredAnimation:this._setExpiredAnimation}));},contentWraps:function(){var l=c('ReactDOM').findDOMNode(this.refs.content),m=l.getClientRects(),n=c('DOMDimensions').getElementDimensions(l).height;return m&&m.length>1&&m[0].height<n;},getBoxWidth:function(){if(!this._boxWidth)this._boxWidth=c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.bubble),'width',true,true,false);return this._boxWidth;}});f.exports=k;},null);
__d('ChatMessage.react',['cssVar','cx','fbt','BootloadedComponent.react','ChatAnimatedGifs','ChatAttachmentProgressBar.react','ChatBubble.react','EmojiLikeUtils','MercuryTimestamp','CSS','immutable','ImmutableObject','JSResource','MercuryAttachment','MercuryConfig','MercuryErrorInfo','MercuryIDs','MercuryMessageActions','MercuryMessageError.react','MercuryMessageInfo','MessagingGiftWrapChecker','MercuryDisplayTimeFilterMessageRenderer','React','ReactDOM','XUISpinner.react','isRTL','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'ChatMessage',propTypes:{message:k.instanceOf(c('ImmutableObject')).isRequired,maxBubbleWidth:k.number.isRequired,onAttachmentLoad:k.func,onStickerClick:k.func,thread:k.instanceOf(c('ImmutableObject'))},componentDidMount:function(){c('CSS').conditionClass(c('ReactDOM').findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var m=this.props.message;return (c('MercuryMessageInfo').isInbound(m)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(m,n){return m.message!==this.props.message||!c('immutable').is(this.props.thread,m.thread);},render:function(){var m=this.props.message,n=c('MercuryAttachment').get(m).length>0,o=c('MercuryMessageInfo').isInbound(m),p=c('MercuryIDs').isGroupChat(m.thread_id),q=c('isRTL')(m.body),r=c('MercuryErrorInfo').hasErrorStatus(m),s="_5wd4"+(o?' '+"_1nc7":'')+(!o?' '+"_1nc6":'')+(n?' '+"_2_-t":'')+(o&&p?' '+"_5ysy":'')+(r?' '+"_1zcs":'')+(q?' '+"direction_rtl":'')+(!q?' '+"direction_ltr":'');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,s)},this._renderInner(),this._renderUndertext()));},_renderInner:function(){var m=this.props.message,n={};if(c('MercuryMessageInfo').isOutbound(m)){var o=j._("{time}",[j.param('time',c('MercuryTimestamp').getPreciseTimestamp(m.timestamp))]);n['data-hover']='tooltip';n['data-tooltip-position']='right';n['data-tooltip-content']=o;}if(m.is_filtered_content)return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9 _5wdc uiBoxYellow clearfix",ref:'inner'},n),c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(m)));return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9",ref:'inner'},n),this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (c('React').createElement('div',{className:"_3ry4",ref:'undertext'},c('React').createElement(c('MercuryMessageError.react'),{className:"_5wda clearfix",message:this.props.message,ref:'status'}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('MercurySpoofWarning.react'),authorID:this.props.message.author,className:"_5wdb"}):null);},_getAttachmentPlaceholder:function(){return (c('React').createElement('div',{style:{padding:'20px',text_align:'center'}},c('React').createElement(c('XUISpinner.react'),null)));},_renderProgressBar:function(){var m=this.props.message;if(!m.ephemeral_ttl_mode||!m.timestamp)return null;return (c('React').createElement(c('ChatAttachmentProgressBar.react'),{ephemeralTTLMode:m.ephemeral_ttl_mode,timestamp:m.timestamp,isMessageAuthor:!c('MercuryMessageInfo').isInbound(m)}));},_renderAttachments:function(m){var n=this.props.message,o=this.props.thread?this.props.thread.custom_like_icon:null,p=m=='inside'?'attachmentsInside':'attachmentsOutside',q=c('MercuryAttachment').get(n).filter(function(t){var u=c('MercuryAttachment').isBubblePreferred(t);return u&&m==='inside'||!u&&m==='outside';}),r=n.attachments.length>0&&n.attachments.every(function(t){return c('MercuryAttachment').isEphemeralAttachmentStyle(t);}),s=this.props.thread&&c('MercuryConfig').CustomColorChatTabGK?this.props.thread.custom_color:'';if(q.length>0)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:this._getAttachmentPlaceholder(),bootloadLoader:c('JSResource')('MercuryAttachments.react'),className:(m==='outside'?"_3e7u":'')+(!!n.body?' '+"_16ys":'')+(!!n.ephemeral_ttl_mode?' '+"_3-rb":'')+(!!s?' '+"_3al":'')+(' '+"_n4o"),attachments:q,customLike:o,customColor:s,isChat:true,isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(n)&&m==='outside',maxWidth:this.props.maxBubbleWidth,message:n,onUnwrap:this._handleUnwrap,renderProgressBar:r?this._renderProgressBar:null,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,ref:p}));},_renderBubble:function(){var m=this.props.message,n=m.body,o=this._renderAttachments('inside'),p=c('MercuryMessageInfo').isInbound(m);if(c('ChatAnimatedGifs').shouldHideBody(m))n='';if(n||o)return (c('React').createElement('div',{className:"_5wde _n4o"},c('React').createElement(c('ChatBubble.react'),{attachments:o,body:n,className:"_5wdf",isMessageAuthor:!p,maxWidth:this.props.maxBubbleWidth,ranges:m.ranges,metaRanges:m.meta_ranges,ref:'bubble',isEmojiLike:c('EmojiLikeUtils').isEmojiLike(m),isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(m),onUnwrap:this._handleUnwrap,threadID:m.thread_id,ttl:m.ephemeral_ttl_mode,timestamp:m.timestamp,customLike:m.customLike,customColor:c('MercuryConfig').CustomColorChatTabGK&&this.props.thread&&this.props.isFromViewer?this.props.thread.custom_color:''})));},_handleUnwrap:function(){var m="2500ms";setTimeout(function(){return this._persistUnwrapping();}.bind(this),m.substring(0,m.length-2));},_persistUnwrapping:function(){c('MercuryMessageActions').get().unwrap(this.props.message);}});f.exports=l;},null);
__d('ChatMessageGroup.react',['cx','fbt','ChatConfig','ChatDateBreak.react','ChatMessage.react','Image.react','immutable','ImmutableObject','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryTimestamp','React','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=new (c('ImmutableObject'))({name:'',href:'#',image_src:''}),l=c('ChatConfig').get('chattab_rounded_profile',false),m=c('React').createClass({displayName:'ChatMessageGroup',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{activeMessageID:j.string,author:j.string,hasDateBreak:j.bool,isCanonical:j.bool,isFromViewer:j.bool,isPageMessage:j.bool,maxBubbleWidth:j.number,messages:j.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:j.func,onStickerClick:j.func,thread:j.instanceOf(c('ImmutableObject')),threadID:j.string},statics:{calculateState:function(o){return {participants:n(o)};}},shouldComponentUpdate:function(o,p){return (this.props.activeMessageID!==o.activeMessageID||this.props.isFromViewer!==o.isFromViewer||!c('immutable').is(this.props.messages,o.messages)||!c('immutable').is(this.state.participants,p.participants)||!c('immutable').is(this.props.thread,o.thread));},render:function(){return (c('React').createElement('div',{className:"_4tdt"},this._renderProfileColumn(),this._renderName(),c('React').createElement('div',{className:"_4tdv"},this._renderMessages())));},_renderProfileColumn:function(){if(this.props.isFromViewer)return null;var o=this.state.participants.get(this.props.author)||k,p=i._("{name} {time}",[i.param('name',o.name),i.param('time',c('MercuryTimestamp').getPreciseTimestamp(this.props.messages.last().timestamp))]),q=o.image_src?c('React').createElement(c('Image.react'),{src:o.image_src}):null;return (c('React').createElement('div',{className:"_31o4"+(l?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':p,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':p,'data-tooltip-position':'left',href:o.href,ref:'link'},q)));},_renderName:function(){if(this.props.isCanonical||this.props.isFromViewer)return null;var o=this.state.participants.get(this.props.messages.first().author);if(!o)return null;var p=o.short_name;if(this.props.thread&&this.props.thread.custom_nickname){var q=c('MercuryIDs').getUserIDFromParticipantID(o.id);if(this.props.thread.custom_nickname[q]){p=this.props.thread.custom_nickname[q];if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var r=c('MercuryConfig').MessengerTextWithEmoticonsModule;p=c('React').createElement(r,{renderEmoticons:true,renderEmoji:true,text:p});}}}return (c('React').createElement('div',{className:"_4tdx"},p));},_renderMessages:function(){var o=this.props.messages.size,p=[];this.props.messages.forEach(function(q,r,s){var t=q.message_id===this.props.activeMessageID;if(t&&!(r===0&&this.props.hasDateBreak))p.push(c('React').createElement(c('ChatDateBreak.react'),{date:new Date(q.timestamp),key:'db:'+q.message_id}));p.push(c('React').createElement(c('ChatMessage.react'),{isFromViewer:this.props.isFromViewer,key:q.message_id,maxBubbleWidth:this.props.maxBubbleWidth,message:q,nextTimestamp:this._getNextTimestamp(s,o,r),onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,thread:this.props.thread}));}.bind(this));return p;},_getNextTimestamp:function(o,p,q){return q<p-1?o.get(q+1).timestamp:this.props.nextTimestamp;}});function n(o){return c('immutable').Map().withMutations(function(p){o.readReceipts.forEach(function(q,r){p.set(r,c('MercuryParticipants').getOrFetch(r));});p.set(o.author,c('MercuryParticipants').getOrFetch(o.author));});}f.exports=m;},null);
__d('MercuryLogMessage.react',['cx','fbt','DOM','DOMDimensions','Event','ImmutableObject','MercuryLogMessageRenderer','MercuryMeMessageProcessor','MercuryLogMessageType','React','ReactDOM','cancelAnimationFrame','emptyFunction','formatDate','joinClasses','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MercuryLogMessage',propTypes:{loadMoreMessages:j.func,maxWidth:j.number,message:j.instanceOf(c('ImmutableObject')).isRequired,onImageLoad:j.func,thread:j.object},getDefaultProps:function(){return {onImageLoad:c('emptyFunction')};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillUnmount:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);},_renderErrorMessage:function(){return (c('React').createElement('a',{onClick:this._loadMoreMessages},i._("\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.")));},_loadMoreMessages:function(){var l=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(l){this.setState({messageText:this._renderErrorMessage()});}else{var m=i._("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.");this.setState({messageText:m});}},componentWillReceiveProps:function(l){if(l.message.log_message_type===c('MercuryLogMessageType').SERVER_ERROR){this._loadMoreMessages();return;}if(c('MercuryMeMessageProcessor').shouldTransform(l.message)){c('MercuryMeMessageProcessor').transformSnippet(l.message.body,l.message.author,l.thread,function(m){this.setState({messageText:m});}.bind(this));return;}c('MercuryLogMessageRenderer').renderText(l.message,l.thread,function(m){this.setState({messageText:m});}.bind(this));},shouldComponentUpdate:function(l,m){return (this.state.messageText!=m.messageText||l.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){this._informAttachmentLoaded();if(!this.refs.attachment)return;c('MercuryLogMessageRenderer').renderAttachmentLegacy(this.refs.attachment,this.props.message);c('DOM').scry(this.refs.wrap,'img').forEach(function(l){var m=c('Event').listen(l,'load',function(){this._informAttachmentLoaded();m.remove();}.bind(this));}.bind(this));},render:function(){return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_5ye6"),ref:'wrap',style:babelHelpers['extends']({},this.props.style,this._getStyle()),title:c('formatDate')(new Date(this.props.message.timestamp),'g:ia')}),c('React').createElement('div',{className:"_5ye7"},c('MercuryLogMessageRenderer').renderIcon(this.props.message),this.state.messageText),c('React').createElement('div',{className:"_5ye8",ref:'attachment'})));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;},_informAttachmentLoaded:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);this._raf=c('requestAnimationFrame')(function(){this.props.onImageLoad&&this.props.onImageLoad(c('DOMDimensions').getElementDimensions(this.refs.wrap).height);delete this._raf;}.bind(this));}});f.exports=k;},null);
__d('MessengerDomIDs',['uniqueID'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSER_INPUT_DESCRIPTION:c('uniqueID')(),CONVERSATION:c('uniqueID')(),MAIN_LABEL:c('uniqueID')(),MUTE_DIALOG_TITLE:c('uniqueID')(),THREAD_INFO_PANEL:c('uniqueID')(),THREAD_TITLE:c('uniqueID')()};f.exports=h;},null);
__d('MessageList.react',['cx','immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryMeMessageProcessor','MercuryMessageGroup','MercuryShareAttachmentRenderLocations','MessengerDomIDs','ReactComponentWithPureRenderMixin','React','ReactDOM','MercuryLogMessageType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=1000*60*60,k=c('React').createClass({displayName:'MessageList',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{DateBreak:i.func.isRequired,deliveryTimestamp:i.number.isRequired,isCanonical:i.bool,isPageMessage:i.bool,location:i.string.isRequired,LogMessage:i.func.isRequired,loadMoreMessages:i.func,MessageGroup:i.func.isRequired,messages:i.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:i.func,onStickerClick:i.func,readReceipts:i.instanceOf(c('immutable').OrderedMap).isRequired,viewer:i.string.isRequired,thread:i.object,threadID:i.string},getInitialState:function(){return {activeMessageID:null,messageGroups:c('MercuryMessageGroup').calculateMessageGroups(this.props.messages,this.props.location)};},componentWillReceiveProps:function(q){if(q.messages!==this.props.messages)this.setState({messageGroups:c('MercuryMessageGroup').calculateMessageGroups(q.messages,q.location)});},render:function(){var q=this.props,r=q.DateBreak,s=q.location,t=q.MessageGroup,u=[],v=this.state.activeMessageID,w=this.state.messageGroups,x=w.length,y=this.props.readReceipts,z=y.last()||0,aa=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer);for(var ba=0;ba<x;ba++){var ca=ba>0?w[ba-1]:null,da=ca&&ca.length>0?ca[ca.length-1]:null,ea=w[ba],fa=ea[0],ga=ea[ea.length-1],ha=false;if(!da||fa.timestamp-da.timestamp>j){ha=true;u.push(c('React').createElement(r,{date:new Date(fa.timestamp),key:'db:'+fa.message_id,ref:'db:'+fa.message_id}));}if(fa.action_type==c('MercuryActionType').LOG_MESSAGE){if((s===c('MercuryShareAttachmentRenderLocations').CHAT||s===c('MercuryShareAttachmentRenderLocations').MESSENGER)&&(fa.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||fa.log_message_type===c('MercuryLogMessageType').PHONE_CALL)){var ia=this._createRTCMessageGroup(fa,aa,w,x,ba,y,z,ga);u.push(ia);}else{var ja=this._createLogMessageGroup(fa);u.push(ja);}continue;}if(c('MercuryMeMessageProcessor').shouldTransform(fa)){u.push(this._createLogMessageGroup(fa));continue;}ea=c('immutable').List(ea);var ka=m(w,x,ba),la=!o(y,ea,ka),ma=n(z,ga),na=p(this.props.deliveryTimestamp,ga);u.push(c('React').createElement(t,{activeMessageID:l(v,ea),author:ea.first().author,deliveryTimestamp:na,hasDateBreak:ha,isCanonical:this.props.isCanonical,isFromViewer:aa===fa.author,isPageMessage:this.props.isPageMessage,key:'mg:'+fa.message_id,lastReadTimestamp:ma,maxBubbleWidth:this.props.maxBubbleWidth,messages:ea,nextTimestamp:ka,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:la?y:c('immutable').OrderedMap(),ref:'mg:'+fa.message_id,thread:this.props.thread,threadID:this.props.threadID}));}return (c('React').createElement('div',{id:s===c('MercuryShareAttachmentRenderLocations').MESSENGER?c('MessengerDomIDs').CONVERSATION:null},u));},getMessageElement:function(q,r){if(r){var s=this.refs['db:'+q];if(s)return c('ReactDOM').findDOMNode(s);}var t=this.state.messageGroups.find(function(w){return w.some(function(x){return x.message_id===q;});});if(!t)return null;var u=t[0].message_id,v=this.refs['mg:'+u];if(!v)return null;if(r&&u===q)return c('ReactDOM').findDOMNode(v);return v.getMessageElement(q);},_handleMessageDeselect:function(q){this.setState(function(r){return {activeMessageID:r.activeMessageID===q?null:r.activeMessageID};});},_handleMessageSelect:function(q){this.setState({activeMessageID:q});},_createRTCMessageGroup:function(q,r,s,t,u,v,w,x){var y=this.props.MessageGroup,z={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:q.log_message_body,log_message_data:q.log_message_data,log_message_type:q.log_message_type,timestamp:q.timestamp}},aa=c('ImmutableObject').setProperty(q,'attachments',[z]);aa=c('ImmutableObject').setProperty(aa,'body','');var ba=c('immutable').List([aa]),ca=m(s,t,u),da=!o(v,ba,ca),ea=n(w,x),fa=p(this.props.deliveryTimestamp,x);return (c('React').createElement(y,{author:ba.first().author,deliveryTimestamp:fa,isFromViewer:r===q.author,key:q.message_id,lastReadTimestamp:ea,maxBubbleWidth:this.props.maxBubbleWidth,messages:ba,nextTimestamp:ca,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:da?v:c('immutable').OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));},_createLogMessageGroup:function(q){var r=this.props.LogMessage;return (c('React').createElement(r,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:q.message_id,loadMoreMessages:this.props.loadMoreMessages,message:q,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread}));}});function l(q,r){return r.find(function(s){return s.message_id===q;})?q:null;}function m(q,r,s){return s<r-1?q[s+1][0].timestamp:Infinity;}function n(q,r){return r.timestamp>q?q:Infinity;}function o(q,r,s){return (r.isEmpty()||q.last()<r.first().timestamp||q.first()>=s);}function p(q,r){return r.timestamp>q?q:Infinity;}f.exports=k;},null);
__d('ChatConversation.react',['invariant','ChatDateBreak.react','ChatMessageGroup.react','immutable','MercuryLogMessage.react','MessageList.react','React','MercuryShareAttachmentRenderLocations','cancelAnimationFrame','requestAnimationFrame'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatConversation',_raf:(undefined,Number),_onMountTimeout:(undefined,Number),propTypes:{contextBanner:i.object,isCanonical:i.bool.isRequired,loadMoreMessages:i.func,maxBubbleWidth:i.number.isRequired,messages:i.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:i.func,onMount:i.func,onStickerClick:i.func,viewer:i.string.isRequired,thread:i.object,threadID:i.string},componentDidMount:function(){this._raf=c('requestAnimationFrame')(function(){this._onMountTimeout=setTimeout(function(){this.props.onMount&&this.props.onMount();delete this._onMountTimeout;}.bind(this),0);delete this._raf;}.bind(this));},componentWillUnmount:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);clearTimeout(this._onMountTimeout);},componentWillReceiveProps:function(k){!(k.maxBubbleWidth===this.props.maxBubbleWidth)?h(0):void 0;},render:function(){return (c('React').createElement('div',null,this.props.contextBanner,c('React').createElement(c('MessageList.react'),{DateBreak:c('ChatDateBreak.react'),LogMessage:c('MercuryLogMessage.react'),MessageGroup:c('ChatMessageGroup.react'),deliveryTimestamp:0,isCanonical:this.props.isCanonical,location:c('MercuryShareAttachmentRenderLocations').CHAT,loadMoreMessages:this.props.loadMoreMessages,maxBubbleWidth:this.props.maxBubbleWidth,messages:this.props.messages,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,readReceipts:c('immutable').OrderedMap(),viewer:this.props.viewer,thread:this.props.thread,threadID:this.props.threadID})));}});f.exports=j;},null);
__d('MercuryTypingAnimation.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryTypingAnimation',propTypes:{color:i.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var k="_4a0v"+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":'');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,k)},c('React').createElement('div',{className:"_4b0g"},c('React').createElement('div',{className:"_5pd7"}),c('React').createElement('div',{className:"_5pd7"}),c('React').createElement('div',{className:"_5pd7"}))));}});f.exports=j;},null);
__d('ChatTypingIndicator.react',['cx','fbt','ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('ChatConfig').get('chattab_rounded_profile',false),l=c('React').createClass({displayName:'ChatTypingIndicator',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{userID:j.string,showName:j.bool},render:function(){var n=void 0;if(this.props.userID)n=c('MercuryParticipants').getNow(this.props.userID);if(!n)return null;return (c('React').createElement('div',{className:"_4tdt"},m(n),this._renderBubble()));},getBubble:function(){return this.refs.bubble;},_renderBubble:function(){var n=this.props.showName;return (c('React').createElement('div',{className:"_4tdv"},c('React').createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(n?' '+"_5ysy":'')},c('React').createElement('div',{className:"_5wd9"+(' '+"_n4o")},c('React').createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},c('React').createElement(c('MercuryTypingAnimation.react'),{className:"_5x7x",ref:'bubble'}))))));}});function m(n){var o=i._("{name}",[i.param('name',n.name)]);return (c('React').createElement('div',{className:"_31o4"+(k?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':o,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':o,'data-tooltip-position':'left',href:n.href||'#',ref:'link'},c('React').createElement(c('Image.react'),{src:n.image_src,ref:'image'}))));}f.exports=l;},null);
__d('ChatTypingIndicators.react',['fbt','ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:i.func,indicatorsWillShow:i.func,indicatorsDidShow:i.func,rootClassName:i.string,threadID:i.string.isRequired,viewer:i.string.isRequired},getDefaultProps:function(){return {indicatorClass:c('ChatTypingIndicator.react'),indicatorsWillShow:c('emptyFunction'),indicatorsDidShow:c('emptyFunction')};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){var k=c('MercuryThreadInformer').getForFBID(this.props.viewer),l=c('MercuryTypingReceiver').getForFBID(this.props.viewer);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(l.addRetroactiveListener('state-changed',this.typingStateChanged),k.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(k){if(k.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(k,l){if(l.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();c('MercuryParticipants').getMulti(this.state.typingUserIDs,function(k){if(this.isMounted())this.state.typingUserIDs.forEach(function(l){var m=k[l],n=this.refs[l]&&this.refs[l].getBubble();if(n&&m)c('TooltipData').set(c('ReactDOM').findDOMNode(n),this.renderTooltip(m.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var k=c('MercuryIDs').isGroupChat(this.props.threadID);return (c('React').createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map(function(l){return (this._renderTypingIndicator(l,!!k));}.bind(this))));},_renderTypingIndicator:function(k,l){var m=this.props.indicatorClass;return (c('React').createElement(m,{key:k,ref:k,showName:l,userID:k}));},renderTooltip:function(k){var l=c('DOM').create('span');c('ReactDOM').render(c('React').createElement('span',null,h._("{name} \u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442 \u0432\u0430\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435...",[h.param('name',k)])),l);return l;},typingStateChanged:function(k){if(this.props.threadID in k)this.setState({typingUserIDs:k[this.props.threadID].slice().sort()});},messagesReceived:function(k,l){if(this.props.threadID in l){var m=l[this.props.threadID],n=c('createObjectFrom')(m.map(function(o){return o.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(o){return !n[o];}).sort()});}}});f.exports=j;},null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_message_list');function i(k){this.$MercuryMessageList1=c('immutable').List(k||[]);this.$MercuryMessageList2();}i.prototype.append=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).push.apply(l,k);this.$MercuryMessageList2();j('append',k);};i.prototype.prepend=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).unshift.apply(l,k);this.$MercuryMessageList2();j('prepend',k);};i.prototype.update=function(k){var l=k.filter(function(m){return this.contains(m);}.bind(this));if(l.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations(function(m){l.forEach(function(n){var o=this.$MercuryMessageList3.get(n.message_id);if(o!==undefined)m.set(o,n);}.bind(this));}.bind(this));j('update',l);};i.prototype.reorder=function(k){this.$MercuryMessageList1=c('immutable').List(k);this.$MercuryMessageList2();j('reorder',k);};i.prototype.at=function(k){return this.$MercuryMessageList1.get(k);};i.prototype.contains=function(k){return this.$MercuryMessageList3.has(k.message_id);};i.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};i.prototype.toMap=function(){return new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k){return [k.message_id,k];}));};i.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k,l){return [k.message_id,l];}));};function j(event,k){c('setTimeoutAcrossTransitions')(function(){h.debug(event,JSON.stringify({messageIDs:k.map(function(l){return l.message_id;})}));},0);}f.exports=i;},null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','MercuryThreads','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i=c('LogHistory').getInstance('mercury_message_store');function j(l,m,n){this.$MercuryMessageStore1=l;this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore3=n?c('MercuryMessages').getForFBID(n):c('MercuryMessages').get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=m||c('MercuryThreadlistConstants').RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=n?c('MercuryThreadInformer').getForFBID(n):c('MercuryThreadInformer').get();this.$MercuryMessageStore9=new (c('SubscriptionsHandler'))();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',function(o,p){return this.$MercuryMessageStore10(p);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(p[this.$MercuryMessageStore1]);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}.bind(this)),this.$MercuryMessageStore8.subscribe('thread-invalidated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore13();}.bind(this)));i.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore14();}j.prototype.setNewThreadID=function(l){this.$MercuryMessageStore15=l;};j.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();i.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};j.prototype.subscribe=function(l){return this.addRetroactiveListener('updated',l);};j.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore14();return true;};j.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return h.isNewEmptyLocalThread(this.$MercuryMessageStore1);};j.prototype.$MercuryMessageStore14=function(){var l=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;i.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:l}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,l,this.$MercuryMessageStore16.bind(this),null,c('MercuryAPIArgsSource').MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,l))c('setImmediate')(function(){this.$MercuryMessageStore12();}.bind(this));};j.prototype.$MercuryMessageStore16=function(l){if(l&&l.length){this.$MercuryMessageStore5=l[0].timestamp;this.$MercuryMessageStore6=l.length;i.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(l&&!l.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore17(j.THREAD_IS_EMPTY);};j.prototype.$MercuryMessageStore10=function(l){var m=[],n=l[this.$MercuryMessageStore1];if(n&&n.length)m=m.concat(n);if(this.$MercuryMessageStore15){var o=l[this.$MercuryMessageStore15];if(o&&o.length){m=m.concat(o);this.$MercuryMessageStore15=null;}}if(m.length){this.$MercuryMessageStore2.append(m);this.$MercuryMessageStore6+=m.length;var p=m.every(function(q){return q.author!=c('MercuryViewer').getID();});this.$MercuryMessageStore17(j.MESSAGES_RECEIVED,{allFromOthers:p});}};j.prototype.$MercuryMessageStore11=function(l){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(l)));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_CHANGED);};j.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_REORDERED);};j.prototype.$MercuryMessageStore13=function(){this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore14();};j.prototype.$MercuryMessageStore17=function(l,m){var n=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers['extends']({messages:n,eventType:l},m));k(this.$MercuryMessageStore1,l,n);};j.prototype.$MercuryMessageStore18=function(){var l=this.$MercuryMessageStore2.at(0);if(l)this.$MercuryMessageStore5=l.timestamp;};function k(l,m,n){c('setTimeoutAcrossTransitions')(function(){i.debug('update:'+m,JSON.stringify({threadID:l,messageIDs:n.map(function(o){return o.message_id;})}));},0);}Object.assign(j,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});c('mixInEventEmitter')(j,{updated:true});f.exports=j;},null);
__d('ChatTabMessagesView',['Animation','Arbiter','BanzaiLogger','Bootloader','CSS','ChatConversation.react','ChatPerfInstrumentation','ChatTabViewEvents','ChatTypingIndicators.react','ChatWelcomeMessage','CurrentUser','DOM','Event','immutable','MercuryLastMessageIndicator.react','LiveTimer','MercuryIDs','MercuryThreads','MercuryMessageStore','MessengerContextBannerBootloader','MessengerHotLikePreviewEvents','React','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','Scroll','ServerTime','Style','SubscriptionsHandler','UserAgent_DEPRECATED','arrayContains','getElementPosition','throttle','isEventSupported'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i=64,j=null,k=20;function l(n){if(j===null){var o=n.childNodes[0];c('Style').set(n,'overflow','scroll');j=o.clientWidth-i;c('Style').set(n,'overflow','');}return j;}function m(n,o,p,q,r,s,t,u,v){this.loadingIcon=r;this.threadID=n;this.sheetController=o;this.scrollContainer=p;this.conversationElem=q;this.contextBannerEligible=v;this.contextBannerElem=null;this.tabView=u;c('LiveTimer').restart(c('ServerTime').get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function w(){c('ChatTabViewEvents').inform('interaction-with-tab',n);}this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Arbiter').subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),c('Event').listen(this.scrollContainer,'mousedown',w));this._initOverflowObserver();var x=c('isEventSupported')('wheel')?'wheel':c('isEventSupported')('mousewheel')?'mousewheel':'DOMMouseScroll';this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,x,w));this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,'scroll',c('throttle')(this.scrolling,50,this)));var y;c('ReactDOM').render(c('React').createElement(c('ChatTypingIndicators.react'),{threadID:this.threadID,indicatorsWillShow:function(){return (y=this.isScrolledToBottom());}.bind(this),indicatorsDidShow:function(){return (y&&this.scrollToBottom(true));}.bind(this),viewer:c('CurrentUser').getID()}),t);var z;this.lastMessageIndicatorNode=s;this.lastMessageIndicator=new (c('ReactComponentRenderer'))(c('MercuryLastMessageIndicator.react'),this.lastMessageIndicatorNode);this.lastMessageIndicator.setProps({threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return z=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return z&&this.scrollToBottom(true);}.bind(this)});this.initializeConversation();}Object.assign(m.prototype,{initializeConversation:function(){this._store=new (c('MercuryMessageStore'))(this.threadID);this._conversation=new (c('ReactComponentRenderer'))(c('ChatConversation.react'),this.conversationElem);this._conversation.setProps({isCanonical:c('MercuryIDs').isCanonical(this.threadID),loadMoreMessages:this._loadMoreMessages.bind(this),maxBubbleWidth:l(this.scrollContainer),messages:c('immutable').List(),onAttachmentLoad:function(n){var o=this.scrollContainer,p=c('Scroll').getTop(o)+o.clientHeight;if(p+n>=o.scrollHeight-k||this._shouldScrollToBottom){this._shouldScrollToBottom=true;this.scrollToBottom();}}.bind(this),onMount:this.scrollToBottom.bind(this),onStickerClick:this._onStickerClick.bind(this),viewer:c('CurrentUser').getID(),threadID:this.threadID});h.getThreadMeta(this.threadID,function(n){return this._conversation.setProps({thread:n});}.bind(this));this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').START,function(n,o){if(this.threadID!==o)return;this._likePreview=n;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();clearInterval(this._scrollToBottomInterval);this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP,function(n){if(this.threadID!==n)return;this._likePreview=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(n){clearInterval(this._scrollToBottomInterval);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').REMOVE,function(n){if(this.threadID!==n)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_initOverflowObserver:function(){if(!c('UserAgent_DEPRECATED').firefox())return;var n=function(){return c('Style').get(document.body,'overflowX')+' '+c('Style').get(document.body,'overflowY');},o=n(),p=function(){var s=n();if(s!==o){o=s;c('Arbiter').inform('overflow-applied-to-body');}};if('MutationObserver' in window){var q=new MutationObserver(p),r={attributes:true,attributeFilter:['class','style']};q.observe(document.documentElement,r);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))p();},false);},_updateMessageFromStore:function(n){if(n.eventType==c('MercuryMessageStore').MESSAGES_RECEIVED&&n.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;this._shouldScrollToBottom=false;}if(n.eventType==c('MercuryMessageStore').MESSAGES_REORDERED){this._loadingMoreMessages=false;c('CSS').hide(this.loadingIcon);}var o=this.isScrolledToBottom(),p=this._getLoadingHeight(),q=this.scrollContainer.scrollHeight,r=c('Scroll').getTop(this.scrollContainer);this._messages=n.messages;var s=c('ChatWelcomeMessage').getWelcomeMessage(this.threadID);if(s)this._messages.push(s);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(o||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(n.eventType==c('MercuryMessageStore').MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-q-p+r);if(!this._initialLoadFinished){this._initialLoadFinished=true;c('ChatPerfInstrumentation').logCHAT_CONVERSATION_TTI();}if(this._store.hasFetchedAll()&&this.contextBannerEligible)this.renderContextBanner(this.threadID);}.bind(this));h.getThreadMeta(this.threadID,function(t){return this._conversation.setProps({thread:t});}.bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(n.eventType==c('MercuryMessageStore').MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(n){this._shouldScrollToBottom=n;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){c('CSS').show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&c('Scroll').getTop(this.scrollContainer);},getThreadID:function(){return this.threadID;},destroy:function(){c('DOM').scry(this.conversationElem,'.stickerContainer').forEach(function(n){return c('ReactDOM').unmountComponentAtNode(n);});this.unmountContextBanner();c('ReactDOM').unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();c('ReactDOM').unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},isScrolledToBottom:function(n){var o=this.scrollContainer;n=n||k;return c('Scroll').getTop(o)+o.clientHeight>=o.scrollHeight-n;},isScrolledNearTop:function(){return c('Scroll').getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(n){this.scrollToPosition(this.scrollContainer.scrollHeight,n);},scrollToPosition:function(n,o){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(o===true){this._scrollTopAnimation=new (c('Animation'))(this.scrollContainer).to('scrollTop',n).ease(c('Animation').ease.end).duration(400).go();}else c('Scroll').setTop(this.scrollContainer,n);},_loadMoreMessages:function(){return this._store.fetchMoreMessages();},_onStickerClick:function(n,o){if(!n||!this.threadID)return;c('BanzaiLogger').log('StickersLoggerConfig',{event:'click_sticker',packid:n,stickerid:o});c('Bootloader').loadModules(["StickerState","StickerActions","StickerStoreController"],function(p,q,r){p.onTrayDataReady(function(){if(c('arrayContains')(p.getPackIDsInTray(),n)){var s=p.getPack(n);if(s&&s.isPromoted)q.addPack(n);q.selectPack(n);q.showStickerTray(this.threadID);}else r.showStore(n);}.bind(this));}.bind(this));},_checkToAnimateSticker:function(){var n=c('getElementPosition')(this.scrollContainer);c('Arbiter').inform('chatScrolled/'+this.threadID,{scrollTop:c('Scroll').getTop(this.scrollContainer),top:n.y,viewHeight:n.height});},setNewThreadID:function(n){this._store.setNewThreadID(n);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(n){return !n.is_like_preview;});return c('immutable').List(this._messages);},renderContextBanner:function(n,o){c('MessengerContextBannerBootloader').getBootloadedComponent(n,c('MercuryShareAttachmentRenderLocations').CHAT,function(p){c('Style').set(this.conversationElem,'padding-top','80px');this._conversation.setProps({contextBanner:p});}.bind(this),o,function(p){c('Style').set(this.conversationElem,'padding-top',p+'px');}.bind(this));},unmountContextBanner:function(){if(this._conversation)this._conversation.setProps({contextBanner:null});}});f.exports=m;},null);
__d('ChatNubLogger',['BanzaiLogger','ScriptPath','pageID'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='TimeSpentChatNubLoggerConfig',i={INPUT_ACTIVE:'active',INPUT_INACTIVE:'inactive'},j={ENTER:'enter',LEAVE:'leave'},k=i.INPUT_INACTIVE,l=0,m=false;function n(){if(k==i.INPUT_ACTIVE&&!m){k=i.INPUT_INACTIVE;o(j.LEAVE);l=0;}else if(k==i.INPUT_INACTIVE&&m){k=i.INPUT_ACTIVE;l=Date.now();o(j.ENTER);}}function o(event){var q=c('BanzaiLogger').create({retry:true}),r=Date.now();q.log(h,{event:event,client_event_time_ms:r,active_time_ms:event==j.LEAVE?r-l:0,page_id:c('pageID'),script_path:c('ScriptPath').getScriptPath(),page_data:c('ScriptPath').getPageInfo()?c('ScriptPath').getPageInfo().extraData:{}});}var p={processEvent:function(q){switch(q){case 'focus':m=true;break;case 'blur':m=false;break;default:break;}n();}};f.exports=p;},null);
__d('ContextualLayerAutoFlipHorizontal',['ContextualLayerAutoFlip'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ContextualLayerAutoFlip'));i=h&&h.prototype;j.prototype.getValidPositions=function(k){'use strict';return [k.getPosition()];};function j(){'use strict';h.apply(this,arguments);}f.exports=j;},null);
__d('ChatContentSearchContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape')],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=i;},null);
__d('ChatFlyoutPlaceholder.react',['React','XUISpinner.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={padding:'30px',textAlign:'center'},i=function(){return (c('React').createElement('div',{style:h},c('React').createElement(c('XUISpinner.react'),{size:'large'})));};f.exports=i;},null);
__d('ChatContentSearchButton.react',['cx','fbt','BootloadOnRender.react','ChatFlyoutPlaceholder.react','ChatContentSearchContextualDialog.react','JSResource','LazyComponent.react','Link.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','MercuryShareAttachmentRenderLocations','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=278,l=c('React').createClass({displayName:'ChatContentSearchButton',_clickGuard:false,mixins:[c('ReactComponentWithPureRenderMixin'),c('ReactLayeredComponentMixin')],propTypes:{ContextualDialogClass:j.func,flyoutAlignment:j.oneOf(['left','right']),getQuery:j.func.isRequired,location:j.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),onLoad:j.func,onSelect:j.func.isRequired},getDefaultProps:function(){return {flyoutAlignment:'left',location:c('MercuryShareAttachmentRenderLocations').CHAT};},getInitialState:function(){return {query:'',shown:false};},componentDidMount:function(){this.props.onLoad&&this.props.onLoad(this);},updateQuery:function(){this.setState({query:this.props.getQuery()});},hideFlyout:function(){this.setState(this.getInitialState());},render:function(){return (c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:i._("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043b GIF \u0438\u043b\u0438 \u043d\u0430\u043a\u043b\u0435\u0439\u043a\u0443"),ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {};var m=this.props.ContextualDialogClass||c('ChatContentSearchContextualDialog.react');return {contextualDialog:c('React').createElement(m,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:k},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{location:this.props.location,onEscKeyDown:this.hideFlyout,onSelect:this._handleSelect,query:this.state.query}),loader:c('JSResource')('ChatContentSearchFlyout.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)}))};},_handleMouseDown:function(m){this._clickGuard=this.state.shown;},_handleClick:function(m){m.stopPropagation();if(this.state.shown||this._clickGuard)return;this.setState({query:this.props.getQuery(),shown:!this.state.shown});},_handleSelect:function(m,n){this.props.onSelect(m,n);this.hideFlyout();},_handleContextualDialogToggle:function(m){this.setState({shown:m});}});f.exports=l;},null);
__d('ChatEmojiCategories',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=[{name:'Smileys',icon:[128515],emojis:[[128512],[128556],[128513],[128514],[128515],[128516],[128517],[128518],[128519],[128521],[128522],[128578],[128579],[9786,65039],[128523],[128524],[128525],[128536],[128535],[128537],[128538],[128540],[128541],[128539],[129297],[129299],[128526],[129303],[128527],[128566],[128528],[128529],[128530],[128580],[129300],[128563],[128542],[128543],[128544],[128545],[128532],[128533],[128577],[9785],[128547],[128534],[128555],[128553],[128548],[128558],[128561],[128552],[128560],[128559],[128550],[128551],[128549],[128546],[128554],[128531],[128557],[128565],[128562],[129296],[128567],[129298],[129301],[128564],[128164],[128169],[128520],[128127],[128121],[128122],[128128],[128123],[128125],[129302],[128570],[128568],[128569],[128571],[128572],[128573],[128576],[128575],[128574],[128588],[128079],[128075],[128077],[128078],[128074],[9994,65039],[9996,65039],[128076],[9995,65039],[128080],[128170],[128591],[9757,65039],[128070],[128071],[128072],[128073],[128405],[128400],[129304],[128406],[9997],[128133],[128068],[128069],[128066],[128067],[128065],[128064],[128100],[128101],[128483],[128118],[128102],[128103],[128104],[128105],[128113],[128116],[128117],[128114],[128115],[128110],[128119],[9937],[128130],[128373],[127877],[128124],[128120],[128112],[128694],[127939],[128131],[128111],[128107],[128108],[128109],[128583],[128129],[128581],[128582],[128587],[128590],[128589],[128135],[128134],[128145],[128105,8205,10084,65039,8205,128104],[128104,8205,10084,65039,8205,128104],[128105,8205,10084,65039,8205,128105],[128143],[128105,8205,10084,65039,8205,128139,8205,128104],[128104,8205,10084,65039,8205,128139,8205,128104],[128105,8205,10084,65039,8205,128139,8205,128105],[128106],[128104,8205,128105,8205,128102],[128104,8205,128105,8205,128103],[128104,8205,128105,8205,128103,8205,128102],[128104,8205,128105,8205,128102,8205,128102],[128104,8205,128105,8205,128103,8205,128103],[128105,8205,128105,8205,128102],[128105,8205,128105,8205,128103],[128105,8205,128105,8205,128103,8205,128102],[128105,8205,128105,8205,128102,8205,128102],[128105,8205,128105,8205,128103,8205,128103],[127995],[127996],[127997],[127998],[127999],[128104,8205,128104,8205,128102],[128104,8205,128104,8205,128103],[128104,8205,128104,8205,128103,8205,128102],[128104,8205,128104,8205,128102,8205,128102],[128104,8205,128104,8205,128103,8205,128103],[128090],[128085],[128086],[128084],[128087],[128089],[128088],[128132],[128139],[128099],[128096],[128097],[128098],[128094],[128095],[128082],[127913],[127891],[128081],[127890],[128093],[128091],[128092],[128188],[128083],[128374],[128141],[127746]]},{name:'Nature',icon:[128059],emojis:[[128054],[128049],[128045],[128057],[128048],[128059],[128060],[128040],[128047],[129409],[128046],[128055],[128061],[128056],[128025],[128053],[128584],[128585],[128586],[128018],[128039],[128038],[128036],[128035],[128037],[128058],[128023],[128052],[129412],[128029],[128027],[128012],[128030],[128028],[128375],[129410],[129408],[128013],[128034],[128032],[128031],[128033],[128044],[128051],[128011],[128010],[128006],[128005],[128003],[128002],[128020],[128004],[128042],[128043],[128024],[128016],[128015],[128017],[128014],[128022],[128000],[128001],[128019],[129411],[128330],[128021],[128041],[128008],[128007],[128063],[128062],[128009],[128050],[127797],[127876],[127794],[127795],[127796],[127793],[127807],[9752],[127808],[127885],[127883],[127811],[127810],[127809],[127806],[127802],[127803],[127801],[127804],[127799],[127800],[127812],[128144],[127792],[127875],[128026],[128376],[127758],[127757],[127759],[127765],[127766],[127767],[127768],[127761],[127762],[127763],[127764],[127770],[127773],[127771],[127772],[127774],[127769],[11088,65039],[127775],[128171],[10024,65039],[9732],[9728,65039],[9925],[127780],[127781],[127782],[9729,65039],[127783],[9928],[127785],[9889,65039],[128293],[128165],[10052],[127784],[9731],[9924,65039],[127788],[128168],[127786],[127787],[9730],[9748,65039],[128167],[128166],[127754]]},{name:'Food',icon:[127860],emojis:[[127823],[127822],[127824],[127818],[127819],[127820],[127817],[127815],[127827],[127816],[127826],[127825],[127821],[127813],[127814],[127798],[127805],[127840],[127838],[129472],[127831],[127830],[127844],[127859],[127828],[127839],[127789],[127829],[127837],[127790],[127791],[127836],[127858],[127845],[127843],[127857],[127835],[127833],[127834],[127832],[127842],[127841],[127847],[127848],[127846],[127856],[127855],[127874],[127854],[127852],[127853],[127851],[127871],[127849],[127850],[127866],[127867],[127863],[127864],[127865],[127870],[127862],[127861],[9749],[127868],[127860],[127869]]},{name:'Activities',icon:[9917,65039],emojis:[[9917,65039],[127936],[127944],[9918,65039],[127934],[127952],[127945],[127921],[9971,65039],[127948],[127955],[127992],[127954],[127953],[127951],[127935],[9975],[127938],[9976],[127993],[127907],[128675],[127946],[127940],[9977],[127947],[128692],[128693],[127943],[128372],[127942],[127933],[127894],[127941],[127895],[127989],[127915],[127903],[127917],[127912],[127914],[127908],[127911],[127932],[127929],[127927],[127930],[127928],[127931],[127916],[127918],[128126],[127919],[127922],[127920],[127923]]},{name:'Travel',icon:[128665],emojis:[[128663],[128661],[128647],[128665],[128652],[128654],[127950],[128659],[128657],[128658],[128656],[128666],[128667],[128668],[127949],[128690],[128680],[128653],[128664],[128660],[128662],[128673],[128672],[128671],[128643],[128651],[128669],[128644],[128645],[128648],[128670],[128642],[128646],[128650],[128649],[128641],[128745],[9992],[128747],[128748],[9973,65039],[128741],[128676],[9972],[128755],[128640],[128752],[128186],[9875],[128679],[9981,65039],[128655],[128678],[128677],[127937],[128674],[127905],[127906],[127959],[127904],[127745],[128508],[127981],[9970,65039],[127889],[9968],[127956],[128507],[127755],[128510],[127957],[127966],[128739],[128740],[127749],[127748],[127964],[127958],[9969],[127965],[127751],[127750],[127961],[127747],[127753],[127756],[127879],[127878],[127752],[127960],[127984],[127983],[127967],[128509],[127968],[127969],[127962],[127970],[127980],[9978,65039],[127971],[127972],[127973],[127974],[127976],[127978],[127979],[127977],[127963],[128146],[9962,65039],[128332],[128333],[128331],[9961],[127776]]},{name:'Objects',icon:[128276],emojis:[[8986],[128241],[128242],[128187],[9000],[128421],[128424],[128433],[128434],[128377],[128189],[128190],[128191],[128192],[128252],[128247],[128248],[128249],[127909],[128253],[127902],[128222],[9742,65039],[128223],[128224],[128250],[128251],[127897],[127898],[127899],[9201],[9202],[9200],[128368],[8987],[9203],[128225],[128267],[128268],[128161],[128294],[128367],[128465],[128738],[128184],[128181],[128180],[128182],[128183],[128176],[128179],[128142],[9878],[128295],[128296],[9874],[128736],[9935],[128297],[128476],[9881],[9939],[128299],[128163],[128298],[128481],[9876],[128737],[128684],[9760],[9904],[9905],[127994],[128302],[128255],[128136],[9879],[128301],[128300],[128371],[128138],[128137],[127777],[127991],[128278],[128701],[128703],[128704],[128705],[128273],[128477],[128715],[128716],[128719],[128682],[128718],[128444],[128506],[128511],[128717],[127880],[127887],[127872],[127873],[127882],[127881],[127886],[127888],[127884],[127982],[9993,65039],[128233],[128232],[128140],[128231],[128238],[128234],[128235],[128236],[128237],[128230],[128239],[128229],[128228],[128220],[128195],[128209],[128202],[128200],[128201],[128196],[128197],[128198],[128467],[128199],[128451],[128499],[128452],[128203],[128466],[128193],[128478],[128194],[128450],[128240],[128211],[128213],[128215],[128216],[128217],[128212],[128210],[128218],[128214],[128279],[128206],[128391],[9986],[128208],[128207],[128204],[128205],[128681],[127987],[127988],[128272],[128274],[128275],[128271],[128394],[128395],[10002],[128221],[9999],[128397],[128396],[128269],[128270]]},{name:'Symbols',icon:[35,8419],emojis:[[10084],[128155],[128154],[128153],[128148],[128156],[10083],[128149],[128147],[128158],[128151],[128152],[128150],[128157],[128159],[9774],[10013],[9770],[128329],[9784],[10017],[128303],[128334],[9775],[9766],[128720],[9934],[9800],[9801],[9802],[9803],[9804],[9805],[9806],[9807],[9808],[9809],[9810],[9811],[127380],[9883],[9762],[9763],[128244],[128243],[127543],[127386],[128174],[127344],[127345],[127374],[127377],[127358],[127384],[9940,65039],[128219],[128683],[10060,65039],[11093,65039],[128162],[9832],[128695],[128687],[128691],[128689],[128286],[128245],[10071,65039],[10069,65039],[10067,65039],[10068,65039],[8252],[8265],[128175],[128261],[128262],[128305],[9884],[12349,65039],[9888],[128696],[128304],[127535],[128185],[10035,65039],[10062,65039],[9989],[128160],[127744],[127760],[9410],[127975],[127490],[128706],[128707],[128708],[128709],[9855,65039],[128685],[128702],[10036,65039],[127359],[128688],[128697],[128698],[128700],[128699],[128686],[127910],[128246],[9167],[127489],[127382],[9851],[127383],[127378],[10055],[127381],[127379],[35,8419],[42,8419],[48,8419],[49,8419],[50,8419],[51,8419],[52,8419],[53,8419],[54,8419],[55,8419],[56,8419],[57,8419],[128287],[128290],[9654],[9208],[9199],[9209],[9210],[9197],[9198],[9194],[128256],[128257],[9193],[128258],[9664],[128316],[128317],[9195],[9196],[127385],[10145,65039],[11013,65039],[11014,65039],[11015,65039],[8599,65039],[8600,65039],[8601,65039],[8598,65039],[8596],[8618],[128260],[8617],[10548,65039],[10549,65039],[8505,65039],[8597],[128292],[128289],[128288],[128291],[127925],[127926],[12336],[10175,65039],[10004],[128259],[10133],[10134],[10135],[10006,65039],[10160],[128178],[128177],[169],[174],[8482,65039],[128282],[128281],[128283],[128285],[128284],[9745],[128280],[9898,65039],[9899,65039],[128308],[128309],[128313],[128312],[128310],[128311],[128314],[9642,65039],[9643,65039],[9724,65039],[9723,65039],[128315],[11035,65039],[11036,65039],[9726,65039],[9725,65039],[128306],[128307],[128264],[128265],[128266],[128263],[128227],[128226],[128276],[126980],[128277],[127183],[9824,65039],[9827,65039],[9829,65039],[9830,65039],[127924],[128065,8205,128488],[128488],[128173],[128495],[128172],[128336],[128337],[128338],[128339],[128340],[128341],[128342],[128343],[128344],[128345],[128346],[128347],[128348],[128349],[128350],[128351],[128352],[128353],[128354],[128355],[128356],[128357],[128358],[128359],[127542],[127568],[127545],[127514],[127538],[127569],[127544],[127540],[127539],[12951,65039],[12953,65039],[127546],[127541]]},{name:'Flags',icon:[127482,127480],emojis:[[127482,127480],[127462,127464],[127482,127486],[127462,127465],[127482,127487],[127462,127466],[127483,127462],[127462,127467],[127483,127464],[127462,127468],[127483,127466],[127462,127470],[127483,127468],[127462,127473],[127483,127470],[127462,127474],[127483,127475],[127462,127476],[127483,127482],[127462,127478],[127484,127467],[127462,127479],[127484,127480],[127462,127480],[127485,127472],[127462,127481],[127486,127466],[127462,127482],[127486,127481],[127462,127484],[127487,127462],[127462,127485],[127487,127474],[127462,127487],[127487,127484],[127463,127462],[127463,127463],[127463,127465],[127463,127466],[127463,127467],[127463,127468],[127463,127469],[127463,127470],[127463,127471],[127463,127473],[127463,127474],[127463,127475],[127463,127476],[127463,127478],[127463,127479],[127463,127480],[127463,127481],[127463,127483],[127463,127484],[127463,127486],[127463,127487],[127464,127462],[127464,127464],[127464,127465],[127464,127467],[127464,127468],[127464,127469],[127464,127470],[127464,127472],[127464,127473],[127464,127474],[127464,127475],[127464,127476],[127464,127477],[127464,127479],[127464,127482],[127464,127483],[127464,127484],[127464,127485],[127464,127486],[127464,127487],[127465,127466],[127465,127468],[127465,127471],[127465,127472],[127465,127474],[127465,127476],[127465,127487],[127466,127462],[127466,127464],[127466,127466],[127466,127468],[127466,127469],[127466,127479],[127466,127480],[127466,127481],[127466,127482],[127467,127470],[127467,127471],[127467,127472],[127467,127474],[127467,127476],[127467,127479],[127468,127462],[127468,127463],[127468,127465],[127468,127466],[127468,127467],[127468,127468],[127468,127469],[127468,127470],[127468,127473],[127468,127474],[127468,127475],[127468,127477],[127468,127478],[127468,127479],[127468,127480],[127468,127481],[127468,127482],[127468,127484],[127468,127486],[127469,127472],[127469,127474],[127469,127475],[127469,127479],[127469,127481],[127469,127482],[127470,127464],[127470,127465],[127470,127466],[127470,127473],[127470,127474],[127470,127475],[127470,127476],[127470,127478],[127470,127479],[127470,127480],[127470,127481],[127471,127466],[127471,127474],[127471,127476],[127471,127477],[127472,127466],[127472,127468],[127472,127469],[127472,127470],[127472,127474],[127472,127475],[127472,127477],[127472,127479],[127472,127484],[127472,127486],[127472,127487],[127473,127462],[127473,127463],[127473,127464],[127473,127470],[127473,127472],[127473,127479],[127473,127480],[127473,127481],[127473,127482],[127473,127483],[127473,127486],[127474,127462],[127474,127464],[127474,127465],[127474,127466],[127474,127467],[127474,127468],[127474,127469],[127474,127472],[127474,127473],[127474,127474],[127474,127475],[127474,127476],[127474,127477],[127474,127478],[127474,127479],[127474,127480],[127474,127481],[127474,127482],[127474,127483],[127474,127484],[127474,127485],[127474,127486],[127474,127487],[127475,127462],[127475,127464],[127475,127466],[127475,127467],[127475,127468],[127475,127470],[127475,127473],[127475,127476],[127475,127477],[127475,127479],[127475,127482],[127475,127487],[127476,127474],[127477,127462],[127477,127466],[127477,127467],[127477,127468],[127477,127469],[127477,127472],[127477,127473],[127477,127474],[127477,127475],[127477,127479],[127477,127480],[127477,127481],[127477,127484],[127477,127486],[127478,127462],[127479,127466],[127479,127476],[127479,127480],[127479,127482],[127479,127484],[127480,127462],[127480,127463],[127480,127464],[127480,127465],[127480,127466],[127480,127468],[127480,127469],[127480,127470],[127480,127471],[127480,127472],[127480,127473],[127480,127474],[127480,127475],[127480,127476],[127480,127479],[127480,127480],[127480,127481],[127480,127483],[127480,127485],[127480,127486],[127480,127487],[127481,127462],[127481,127464],[127481,127465],[127481,127467],[127481,127468],[127481,127469],[127481,127471],[127481,127472],[127481,127473],[127481,127474],[127481,127475],[127481,127476],[127481,127479],[127481,127481],[127481,127483],[127481,127484],[127481,127487],[127482,127462],[127482,127468],[127482,127474]]}];f.exports={categories:h};},null);
__d('ChatEmojiCategoryPicker.react',['cx','fbt','ix','EmojiLikeConstants','EmojiLikeUtils','Grid.react','Image.react','MercuryConfig','ReactComponentWithPureRenderMixin','React','XUICarousel.react','XUICarouselAnimator','XUICarouselArrow.react','XUICarouselItem.react'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('Grid.react').GridItem,l=c('React').PropTypes,m=5,n=c('React').createClass({displayName:'ChatEmojiCategoryPicker',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{categories:l.arrayOf(l.object).isRequired,currentCategoryName:l.string,onSelect:l.func.isRequired},getInitialState:function(){return {animator:new (c('XUICarouselAnimator'))({type:'horizontal'}),page:0};},render:function(){var o=[];if(this.state.page>0)o.push(c('React').createElement(c('XUICarouselItem.react'),{className:"_1uwx _3we9",key:'dummy'}));return (c('React').createElement(c('XUICarousel.react'),{animator:this.state.animator,arrows:this._renderArrows(),className:"_3wea",initialAutoplay:false,initialIndex:0,onItemClick:function(){return null;},resizeViewport:'disabled',viewportWidth:this.props.width,viewportHeight:this.props.height},o.concat(this._getCurrentPageCategories().map(function(p){return this._renderCarouselItemForCategory(p);}.bind(this)))));},_getCurrentPageCategories:function(){var o=this.state.page*m,p=o+m;return this.props.categories.slice(o,p);},_renderCarouselItemForCategory:function(o){var p=null;if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerNewEmojiUtils){var q=c('MercuryConfig').MessengerNewEmojiUtils,r=q.getNewEmojiData(String.fromCodePoint.apply(String,o.icon),c('EmojiLikeConstants').size.SMALL);p=r?r.emoji:null;}else{var s=c('EmojiLikeUtils').getURI(String.fromCodePoint.apply(String,o.icon),c('EmojiLikeConstants').size.SMALL);p=s?c('React').createElement(c('Image.react'),{src:s}):null;}return p?c('React').createElement(c('XUICarouselItem.react'),{className:(o.name==this.props.currentCategoryName?"_1uwz":'')+(' '+"_1uwx"),'data-hover':'tooltip','data-tooltip-content':o.name,key:o.name},c('React').createElement('div',{className:"_1uw-",onClick:function(){return this.props.onSelect(o);}.bind(this)},p)):null;},_numPages:function(){return Math.max(1,Math.ceil((this.props.categories.length-1)/m));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_onClickPreviousArrow:function(o){if(this._canGoPrev())this.setState({page:this.state.page-1});o.stopPropagation();},_onClickNextArrow:function(o){if(this._canGoNext())this.setState({page:this.state.page+1});o.stopPropagation();},_renderArrows:function(){return [c('React').createElement(c('XUICarouselArrow.react'),{className:"_3web"+(!this._canGoPrev()?' '+"hidden_elem":''),disabled:!this._canGoPrev(),onClick:function(o){return this._onClickPreviousArrow(o);}.bind(this)},c('React').createElement(c('Image.react'),{className:"_3wec",alt:i._("\u041d\u0430 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0443\u044e"),src:j('/images/messaging/stickers/selector/left.png')})),c('React').createElement(c('XUICarouselArrow.react'),{className:"_3web"+(!this._canGoNext()?' '+"hidden_elem":''),disabled:!this._canGoNext(),onClick:function(o){return this._onClickNextArrow(o);}.bind(this)},c('React').createElement(c('Image.react'),{className:"_3wec",alt:i._("\u0414\u0430\u043b\u0435\u0435"),src:j('/images/messaging/stickers/selector/right.png')}))];}});f.exports=n;},null);
__d('ChatEmojiPickerButton.react',['cx','fbt','Image.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatEmojiPickerButton',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{emojiData:j.object.isRequired,onClick:j.func.isRequired,onLongPress:j.func.isRequired},_inLongPressMode:false,_longPressTimeout:null,render:function(){return (c('React').createElement('div',{'aria-label':i._("\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043c\u0430\u0439\u043b\u0438\u043a"),onClick:this._handleClick,onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp,ref:'div',role:'button'},c('React').createElement(c('Image.react'),{className:"_1lih _1ift _1ifu",style:{margin:0},src:this.props.emojiData.uri})));},_handleClick:function(l){l.stopPropagation();this.props.onClick(this.props.emojiData.emojiCodes);},_handleMouseDown:function(l){l.stopPropagation();if(this._inLongPressMode)this._inLongPressMode=false;this._longPressTimeout=setTimeout(this._informLongPress,1000);},_handleMouseUp:function(l){l.stopPropagation();if(!this._inLongPressMode){clearTimeout(this._longPressTimeout);}else this._inLongPressMode=false;},_informLongPress:function(){this._inLongPressMode=true;this.props.onLongPress(this.props.emojiData.emojiCodes,this.refs.div);}});f.exports=k;},null);
__d('MessengerScrollableArea.react',['cx','React','ReactDOM','ScrollableArea.react','Style','UserAgent','clearImmediate','joinClasses','setImmediate','throttle'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=20,k=c('React').createClass({displayName:'MessengerScrollableArea',propTypes:{onScroll:i.func,width:i.number},_resizeCallback:null,componentDidMount:function(){this._resizeCallback=c('setImmediate')(this._resize);},componentWillUnmount:function(){c('clearImmediate')(this._resizeCallback);},render:function(){return (c('React').createElement(c('ScrollableArea.react'),{className:c('joinClasses')("_5f0v",this.props.className),height:this.props.height,onScroll:this._handleScroll,ref:'scrollable',shadow:false,style:this.props.style,tabIndex:this.props.tabIndex,width:this.props.width},this.props.children));},_handleScroll:c('throttle')(function(){var l;this.props.onScroll&&(l=this.props).onScroll.apply(l,arguments);},50),_resize:function(){if(!c('UserAgent').isBrowser('IE'))return;var l=this.refs.scrollable.refs.wrap,m=this.refs.scrollable.refs.body;if(!m||!l)return;m=c('ReactDOM').findDOMNode(m);l=c('ReactDOM').findDOMNode(l);var n=l.offsetWidth-l.clientWidth;if(n>0)c('Style').set(m,'margin-right',-n+'px');},getArea:function(){return this.refs.scrollable.getArea();},scrollToBottom:function(){var l=this.getArea();if(l)this.scrollToPosition(l.getScrollHeight());},scrollToTop:function(l){var m=this.getArea();if(m)m.scrollToTop(!!l);},scrollToPosition:function(l){var m=this.getArea();if(!m)return;m.setScrollTop(l,false);},isScrolledToBottom:function(){return this.isScrolledToBottomWithHeight(0);},isScrolledToBottomWithHeight:function(l){var m=this.getArea();if(!m)return false;return m.getScrollTop()+m.getClientHeight()+l>=m.getScrollHeight()-j;},isScrolledToTop:function(){var l=this.getArea();if(!l)return true;return l.getScrollTop()<=j;},getScrollTop:function(){var l=this.getArea();if(!l)return 0;return l.getScrollTop();}});f.exports=k;},null);
__d('EmojiFormat',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j){return j.split('_').map(function(k){return parseInt(k,16);});}function i(j){return j.map(function(k){return k.toString(16);}).join('_');}f.exports={codeArrayToCodeString:i,codeStringToCodeArray:h};},null);
__d('SkinToneEmoji',['EmojiFormat','MessengerEmojiConfig'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=65039,i={'261d':1,'26f9':1,'270a':1,'270b':1,'270c':1,'270d':1,'1f385':1,'1f3c3':1,'1f3c4':1,'1f3ca':1,'1f3cb':1,'1f442':1,'1f443':1,'1f446':1,'1f447':1,'1f448':1,'1f449':1,'1f44a':1,'1f44b':1,'1f44c':1,'1f44d':1,'1f44e':1,'1f44f':1,'1f450':1,'1f466':1,'1f467':1,'1f468':1,'1f469':1,'1f46e':1,'1f470':1,'1f471':1,'1f472':1,'1f473':1,'1f474':1,'1f475':1,'1f476':1,'1f477':1,'1f478':1,'1f47c':1,'1f481':1,'1f482':1,'1f483':1,'1f485':1,'1f486':1,'1f487':1,'1f4aa':1,'1f575':1,'1f590':1,'1f595':1,'1f596':1,'1f645':1,'1f646':1,'1f647':1,'1f64b':1,'1f64c':1,'1f64d':1,'1f64e':1,'1f64f':1,'1f6a3':1,'1f6b4':1,'1f6b5':1,'1f6b6':1,'1f6c0':1,'1f918':1};function j(s){if(s[s.length-1]===h)return s[s.length-1];return 0;}function k(s){if(s[s.length-1]===h)return s;var t=s.slice(0);t.push(h);return t;}function l(s){if(j(s)===0)return s;return s.slice(0,s.length-1);}function m(s){return p(l(s));}function n(s){var t=c('EmojiFormat').codeArrayToCodeString(m(s));return !!i[t];}function o(s,t){if(t===0)return s;var u=j(s),v=u===0?s.slice(0):s.slice(0,s.length-1);if(q(v)!==0)return s;v.push(t);if(u!==0)v.push(u);return v;}function p(s){var t=j(s),u=t===0?q(s):q(s.slice(0,s.length-1));if(u===0)return s;return t===0?s.slice(0,s.length-1):k(s.slice(0,s.length-2));}function q(s){var t=l(s);if(t.length<=1||!r(t[t.length-1]))return 0;return t[t.length-1];}function r(s){return c('MessengerEmojiConfig').emoji_colors.filter(function(t){return t===s;}).length!==0;}f.exports={addEmojiModifier:k,applyTone:o,getEmojiModifier:j,getTone:q,removeEmojiModifier:l,removeTone:p,emoji:i,hasVariations:n};},null);
__d('ChatEmojiPicker.react',['cx','ChatEmojiPickerButton.react','ChatEmojiSkinToneSelector.react','EmojiLikeConstants','EmojiLikeUtils','Grid.react','MercuryConfig','MessengerScrollableArea.react','ReactComponentWithPureRenderMixin','React','SkinToneEmoji'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('Grid.react').GridItem,j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatEmojiPicker',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{className:j.string,columns:j.number,currentEmoji:j.string,emojiChoices:j.arrayOf(j.arrayOf(j.number)).isRequired,onSelect:j.func,useSkinToneSelector:j.bool},_inLongPress:false,getDefaultProps:function(){return {columns:7,useSkinToneSelector:false};},getInitialState:function(){return {selectedEmoji:[],toneSelectorShown:false,toneSelectorContext:null};},render:function(){var l=this.props.emojiChoices.map(function(m){var n=String.fromCodePoint.apply(String,m);if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerNewEmojiUtils)var o=c('MercuryConfig').MessengerNewEmojiUtils,p=o.getNewEmojiData(n,c('EmojiLikeConstants').size.SMALL);var q=p?p.url:c('EmojiLikeUtils').getURI(n,c('EmojiLikeConstants').size.SMALL);return q?c('React').createElement(i,{key:m.join('_'),className:"_3-sy"},c('React').createElement('div',{className:(n===this.props.currentEmoji?"_4rlt":'')+(' '+"_4rlu")},c('React').createElement(c('ChatEmojiPickerButton.react'),{emojiData:{emojiCodes:m,uri:q},onClick:this._handleClick,onLongPress:this._handleLongPress}))):null;}.bind(this)).filter(function(m){return !!m;});return (c('React').createElement(c('MessengerScrollableArea.react'),{className:this.props.className,height:this.props.height,onScroll:this._hideToneSelector,ref:'scrollable'},c('React').createElement(c('Grid.react'),{cols:this.props.columns,className:"_3-s_"},l),this.props.useSkinToneSelector?c('React').createElement(c('ChatEmojiSkinToneSelector.react'),{context:this.state.toneSelectorContext,emojiCodes:this.state.selectedEmoji,shown:this.state.toneSelectorShown,onBlur:this._handleSelectorBlur,onSelect:this._handleSelect}):null));},_handleSelect:function(l){this.props.onSelect&&this.props.onSelect(l);},_handleClick:function(l){if(this._inLongPress){this._inLongPress=false;}else this._handleSelect(l);},_handleLongPress:function(l,m){if(this.props.useSkinToneSelector&&c('SkinToneEmoji').hasVariations(l)){this.setState({toneSelectorShown:true,selectedEmoji:l,toneSelectorContext:m});this._inLongPress=true;}},_handleSelectorBlur:function(){if(!this._inLongPress)this._hideToneSelector();},_hideToneSelector:function(){this.setState({toneSelectorShown:false});}});f.exports=k;},null);
__d('ChatEmojiSkinToneFlyout.react',['ChatEmojiPicker.react','MessengerEmojiConfig','ReactComponentWithPureRenderMixin','React','SkinToneEmoji'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'ChatEmojiSkinToneFlyout',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{className:h.string,emojiCodes:h.arrayOf(h.number).isRequired,onSelect:h.func.isRequired},render:function(){var j=this,k=[];if(this.props.emojiCodes.length>0)(function(){var l=c('SkinToneEmoji').removeTone(j.props.emojiCodes);k=c('MessengerEmojiConfig').emoji_colors.map(function(m){return (c('SkinToneEmoji').applyTone(l,m));});})();return (c('React').createElement(c('ChatEmojiPicker.react'),{className:this.props.className,columns:6,emojiChoices:k,onSelect:this.props.onSelect}));}});f.exports=i;},null);
__d('ChatEmojiSkinToneSelector.react',['cx','ChatEmojiSkinToneFlyout.react','ContextualLayerAutoFlip','ReactComponentWithPureRenderMixin','React','XUIContextualDialog.react','emptyFunction'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=220,k=c('React').createClass({displayName:'ChatEmojiSkinToneSelector',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{context:i.instanceOf(HTMLElement),emojiCodes:i.arrayOf(i.number).isRequired,onBlur:i.func.isRequired,onSelect:i.func.isRequired,shown:i.bool},render:function(){return (c('React').createElement(c('XUIContextualDialog.react'),{behaviors:{ContextualLayerAutoFlip:c('ContextualLayerAutoFlip')},context:this.props.context,contextRef:c('emptyFunction'),onBlur:this.props.onBlur,onToggle:this._handleContextualDialogToggle,shown:this.props.shown,width:j},c('React').createElement(c('ChatEmojiSkinToneFlyout.react'),{className:"_2ejf",emojiCodes:this.props.emojiCodes,onSelect:this.props.onSelect})));}});f.exports=k;},null);
__d('ChatEmojiFlyout.react',['cx','ChatEmojiCategories','ChatEmojiCategoryPicker.react','ChatEmojiPicker.react','Keys','MessengerEmojiConfig','MessengerSupportedEmoji','ReactComponentWithPureRenderMixin','React','SkinToneEmoji'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=50,k=c('React').createClass({displayName:'ChatEmojiFlyout',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{onEscKeyDown:i.func,onSelect:i.func.isRequired,emojiColor:i.number.isRequired},getInitialState:function(){return {categories:this._getCategories(),currentCategory:c('ChatEmojiCategories').categories[0]};},getDefaultProps:function(){return {emojiColor:0};},render:function(){return (c('React').createElement('div',{className:"_4pi8",onKeyDown:this._handleKeyDown},c('React').createElement('div',{className:"_4pi9"},c('React').createElement(c('ChatEmojiCategoryPicker.react'),{categories:this.state.categories,currentCategoryName:this.state.currentCategory.name,height:j,onSelect:this._handleSelectCategory,width:this.props.width}),c('React').createElement(c('ChatEmojiPicker.react'),{className:"_4pia",columns:6,emojiChoices:this.state.currentCategory.emojis.filter(function(l){return l.length<=2;}).map(function(l){if(this.props.emojiColor!=0&&c('SkinToneEmoji').hasVariations(l))return c('SkinToneEmoji').applyTone(l,this.props.emojiColor);return l;}.bind(this)),height:'85%',onSelect:this.props.onSelect,useSkinToneSelector:true}))));},_getCategories:function(){var l=c('MessengerEmojiConfig').recents.map(function(n){var o=c('MessengerSupportedEmoji').findEmoji(n);if(!o)return null;return o.emoji.split('_').map(function(p){return parseInt(p,16);});}).filter(function(n){return !!n;}),m=[];if(l.length>0)m.push({name:'recents',emojis:l,icon:[128340]});return m.concat(c('ChatEmojiCategories').categories);},_handleKeyDown:function(l){if(l.keyCode===c('Keys').ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown();},_handleSelectCategory:function(l){this.setState({currentCategory:l});}});f.exports=k;},null);
__d('ChatEmojiButton.react',['cx','fbt','Bootloader','BootloadOnRender.react','ChatEmojiFlyout.react','ChatFlyoutPlaceholder.react','JSResource','LazyComponent.react','Link.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','XUIContextualDialog.react','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=278,l=c('React').createClass({displayName:'ChatEmojiButton',_clickGuard:false,mixins:[c('ReactComponentWithPureRenderMixin'),c('ReactLayeredComponentMixin')],propTypes:{ContextualDialogClass:j.func.isRequired,flyoutAlignment:j.oneOf(['left','right']),onSelect:j.func},getDefaultProps:function(){return {ContextualDialogClass:c('XUIContextualDialog.react'),flyoutAlignment:'left'};},getInitialState:function(){return {shown:false,emojiColor:0};},hideFlyout:function(){this.setState(this.getInitialState());},render:function(){return (c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:i._("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043c\u0430\u0439\u043b\u0438\u043a"),ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {};var m=this.props.ContextualDialogClass;return {contextualDialog:c('React').createElement(m,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:k},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{onEscKeyDown:this.hideFlyout,onSelect:this._handleSelect,emojiColor:this.state.emojiColor,width:k}),loader:c('JSResource')('ChatEmojiFlyout.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)}))};},_handleMouseDown:function(m){this._clickGuard=this.state.shown;},_handleClick:function(m){if(this.state.shown||this._clickGuard)return;c('Bootloader').loadModules(["AsyncRequest","XMessagingGetEmojiColorPrefController"],function(n,o){var p=o.getURIBuilder().getURI();new n(p).setMethod('POST').setHandler(function(q){return (this.setState({emojiColor:q.payload,shown:!this.state.shown}));}.bind(this)).send();}.bind(this));m.stopPropagation();},_handleSelect:function(m){this.props.onSelect&&this.props.onSelect(m);},_handleContextualDialogToggle:function(m){this.setState({shown:m});}});f.exports=l;},null);
__d('MessengerEmojiSpan.react',['cx','DraftEntity','EmojiLikeConstants','MercuryConfig','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerEmojiSpan',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{children:i.arrayOf(i.object),entityKey:i.string.isRequired,offsetKey:i.string},render:function(){var k=c('DraftEntity').get(this.props.entityKey),l=k.getData(),m=l.type,n=c('MercuryConfig').MessengerNewEmojiUtils.getUrl(m,c('EmojiLikeConstants').size.XSMALL);return (c('React').createElement('span',{className:"_21wj",style:{backgroundImage:'url('+n+')'},'data-offset-key':this.props.offsetKey},c('React').createElement('span',{className:"_21wk"},this.props.children)));}});f.exports=j;},null);
__d('MessengerEmoticonSpan.react',['cx','DraftEntity','EmojiLikeConstants','EmoticonEmojiList','MercuryConfig','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerEmoticonSpan',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{children:i.arrayOf(i.object),entityKey:i.string.isRequired,offsetKey:i.string},render:function(){var k=c('DraftEntity').get(this.props.entityKey),l=k.getData(),m=l.type,n=c('EmoticonEmojiList').emote2emojis[m],o=c('MercuryConfig').MessengerNewEmojiUtils.getUrl(n,c('EmojiLikeConstants').size.XSMALL);return (c('React').createElement('span',{className:"_21wj",style:{backgroundImage:'url('+o+')'},'data-offset-key':this.props.offsetKey},c('React').createElement('span',{className:"_21wk"},this.props.children)));}});f.exports=j;},null);
__d('getVisibleValueForContentStateWithMessengerEmoji',['ContentState','DraftEntity','EmojiFormat','emptyFunction'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=i.getBlockMap().map(function(k){var l=k.getText(),m='';k.findEntityRanges(c('emptyFunction').thatReturnsTrue,function(n,o){var p=k.getEntityAt(n);if(!p){m+=l.slice(n,o);}else{var q=c('DraftEntity').get(p);if(q.getType()==='EMOTICON'){m+=q.getData().originalEmoticon;}else if(q.getType()==='EMOJI'){var r=q.getData().type,s=c('EmojiFormat').codeStringToCodeArray(r);m+=String.fromCodePoint.apply(String,s);}else m+=l.slice(n,o);}});return m;});return j.join('\n');}f.exports=h;},null);
__d('insertMessengerEmojiIntoContentState',['ContentState','DraftEntity','DraftModifier','SelectionState'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='\u3000';function i(j,k,l,m){var n=c('DraftEntity').create('EMOJI','IMMUTABLE',{type:j});return c('DraftModifier').insertText(k,l,h,m,n);}f.exports=i;},null);
__d('handleBeforeInputForMessengerEmoji',['EditorState','MessengerSupportedEmoji','insertMessengerEmojiIntoContentState'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=i.getSelection();if(!k.isCollapsed()||!j)return i;var l=c('MessengerSupportedEmoji').findEmoji(j);if(!l)return i;var m=c('insertMessengerEmojiIntoContentState')(l.emoji,i.getCurrentContent(),k,i.getCurrentInlineStyle());return c('EditorState').push(i,m,'insert-characters');}f.exports=h;},null);
__d('applyMessengerEmoticonToContentState',['EmoticonEmojiList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j.getAnchorKey(),l=j.getAnchorOffset(),m=i.getBlockForKey(k),n=c('getTextAfterNearestEntity')(m,l),o=c('EmoticonEmojiList').regexp.exec(n);if(!o)return i;var p=o[1];if(!p&&l!==n.length)return i;var q=o[2],r=l-n.length,s=r+o.index+o[1].length,t=i.getBlockMap().set(k,c('applyEmoticonToContentBlock')(m,q,s));l-=q.length-1;return i.merge({blockMap:t,selectionBefore:j,selectionAfter:j.merge({anchorOffset:l,focusOffset:l})});}f.exports=h;},null);
__d('handleBeforeInputForMessengerEmoticon',['DraftModifier','EditorState','applyMessengerEmoticonToContentState'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyMessengerEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;},null);
__d('ChatInput.react',['ContentState','CompositeDraftDecorator','DraftEditor.react','DraftModifier','EditorState','EmojiFormat','EmoticonSpan.react','MercuryConfig','MessengerEmojiSpan.react','MessengerEmoticonSpan.react','React','ReactDOM','clearImmediate','emptyFunction','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','getVisibleValueForContentStateWithMessengerEmoji','handleBeforeInputForEmoticon','handleBeforeInputForMessengerEmoji','handleBeforeInputForMessengerEmoticon','handleSoftNewlineForEmoticon','insertEmoticonIntoEditorState','insertMessengerEmojiIntoContentState','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('emptyFunction').thatReturnsNull,j=c('React').createClass({displayName:'ChatInput',propTypes:{blockStyleFn:h.func,initializeThingsWithInputFn:h.func,inputKeyDown:h.func,keyBindingFn:h.func,onBlur:h.func,onEscape:h.func,onFocus:h.func,onTab:h.func,resizeFn:h.func},getDefaultProps:function(){return {blockStyleFn:i,keyBindingFn:c('getDefaultKeyBinding')};},componentDidMount:function(){this._oldHeight=c('ReactDOM').findDOMNode(this).getBoundingClientRect().height;this.props.resizeFn(this._oldHeight);this.props.initializeThingsWithInputFn(c('ReactDOM').findDOMNode(this.refs.input),this.getValue);this.setState({triggeredWord:this.props.triggeredWord});},componentWillUnmount:function(){if(this._updateToken)c('clearImmediate')(this._updateToken);this._updateToken=null;},componentWillReceiveProps:function(k){if(this.state.triggeredWord!==k.triggeredWord)this.setState({triggeredWord:k.triggeredWord},this._updateDecorator);},componentDidUpdate:function(){this._updateToken=c('setImmediate')(function(){this._updateToken=null;var k=c('ReactDOM').findDOMNode(this).getBoundingClientRect(),l=k.height;if(this._oldHeight!==l)this.props.resizeFn(l);this._oldHeight=l;}.bind(this));},getInitialState:function(){return {editorState:this._createEmptyEditorState()};},_createEmptyEditorState:function(){return c('EditorState').createWithContent(c('ContentState').createFromText(''),this._getDecorator());},resetState:function(){if(this.state.typeaheadReporter){this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}this.setState({editorState:c('EditorState').moveFocusToEnd(this._createEmptyEditorState()),triggeredWord:null});},_updateDecorator:function(){var k=this._getDecorator();c('setImmediate')(function(){var l=c('EditorState').set(this.state.editorState,{decorator:k});this.setState({editorState:l});}.bind(this));},_getDecorator:function(){var k=c('MercuryConfig').MessengerNewEmojiGK,l=k?c('MessengerEmoticonSpan.react'):c('EmoticonSpan.react'),m=[{strategy:c('getEntityMatcher')(function(n){return n.getType()==='EMOTICON';}),component:l}];if(k)m.push({strategy:c('getEntityMatcher')(function(n){return n.getType()==='EMOJI';}),component:c('MessengerEmojiSpan.react')});return new (c('CompositeDraftDecorator'))(m);},onChange:function(k){this.setState({editorState:k});},onReturn:function(event){if(c('isSoftNewlineEvent')(event)){var k=c('handleSoftNewlineForEmoticon')(this.state.editorState);if(k===this.state.editorState)return false;this.setState({editorState:k});return true;}this.props.inputKeyDown(event,this.getValue());return true;},getValueFromEditorState:function(k){var l=k.getCurrentContent();return c('MercuryConfig').MessengerNewEmojiGK?c('getVisibleValueForContentStateWithMessengerEmoji')(l):c('getVisibleValueForContentState')(l);},getValue:function(){return this.getValueFromEditorState(this.state.editorState);},focus:function(){this.refs.input.focus();},_handleBeforeInput:function(k){var l=this._handleBeforeInputForEmoticon(k),m=this._handleBeforeInputForEmoji(k);return l||m;},_handleBeforeInputForEmoticon:function(k){var l=c('MercuryConfig').MessengerNewEmojiGK?c('handleBeforeInputForMessengerEmoticon')(this.state.editorState,k):c('handleBeforeInputForEmoticon')(this.state.editorState,k);if(l===this.state.editorState)return false;this.setState({editorState:l});return true;},_handleBeforeInputForEmoji:function(k){if(!c('MercuryConfig').MessengerNewEmojiGK)return false;var l=c('handleBeforeInputForMessengerEmoji')(this.state.editorState,k);if(l===this.state.editorState)return false;this.setState({editorState:l});return true;},_handleFiles:function(k){var l=/^image\//,m=k.filter(function(n){return l.test(n.type);});if(m.length){this.props.uploadPhotoFn(m[0]);return true;}return false;},_handlePastedFiles:function(k){return this._handleFiles(k);},_handleDroppedFiles:function(k,l){return this._handleFiles(l);},insertEmoticon:function(k){var l=c('insertEmoticonIntoEditorState')(k,this.state.editorState);if(l!==this.state.editorState)this.setState({editorState:l});},insertEmoji:function(k){var l=this.state.editorState,m=c('insertMessengerEmojiIntoContentState')(c('EmojiFormat').codeArrayToCodeString(k),l.getCurrentContent(),l.getSelection(),l.getCurrentInlineStyle()),n=c('EditorState').push(l,m,'insert-characters');if(n!==this.state.editorState)this.setState({editorState:n});},appendText:function(k){var l=this.state.editorState,m=l.getSelection(),n=l.getCurrentContent();n=c('DraftModifier').insertText(n,m,k);l=c('EditorState').push(l,n,'insert-characters');this.setState({editorState:l});},render:function(){return (c('React').createElement(c('DraftEditor.react'),babelHelpers['extends']({ref:'input'},this.props,{editorState:this.state.editorState,onChange:this.onChange,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,handleReturn:this.onReturn,spellCheck:true,stripPastedStyles:true})));}});f.exports=j;},null);
__d('ChatInputBasic.react',['cx','FocusListener','FlipDirectionOnKeypress','React','ReactDOM','TextAreaControl','setImmediate'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();c('FocusListener');c('FlipDirectionOnKeypress');var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatInputBasic',_oldHeight:undefined,_textAreaControl:undefined,propTypes:{initializeThingsWithInputFn:i.func.isRequired,inputKeyDown:i.func.isRequired,onBlur:i.func,onFocus:i.func,placeholder:i.string,resizeFn:i.func.isRequired},getInitialState:function(){return {value:''};},componentDidMount:function(){this._oldHeight=c('ReactDOM').findDOMNode(this).getBoundingClientRect().height;this.props.resizeFn(this._oldHeight);this.props.initializeThingsWithInputFn(c('ReactDOM').findDOMNode(this.refs.input),this.getValue);this._textAreaControl=c('TextAreaControl').getInstance(this.refs.input);},componentDidUpdate:function(){c('setImmediate')(function(){var k=c('ReactDOM').findDOMNode(this).getBoundingClientRect().height;if(this._oldHeight!==k)this.props.resizeFn(k);this._oldHeight=k;}.bind(this));},onChange:function(k){this._textAreaControl&&this._textAreaControl.onupdate();this.setState({value:k.target.value||''});},focus:function(){this.refs.input.focus();},getValue:function(){return this.state.value;},resetState:function(){this.setState(this.getInitialState());},appendText:function(k){this.setState({value:this.state.value+k});},render:function(){return (c('React').createElement('textarea',babelHelpers['extends']({ref:'input'},this.props,{value:this.state.value,onChange:this.onChange,onKeyDown:this.props.inputKeyDown,autogrow:'true',className:"_552m uiTextareaNoResize uiTextareaAutogrow",'data-jsid':'input'})));}});f.exports=j;},null);
__d('ChatPhotoUploader.react',['cx','fbt','Promise','Bootloader','InlineBlock.react','Link.react','MercuryConfig','React','ReactDOM','SubscriptionsHandler','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:j.string,allowCrossPage:j.bool,customUI:j.bool,disabled:j.bool,imageClassName:j.string,imagesOnly:j.bool,linkClassName:j.string,onSubmit:j.func,onAllUploadsComplete:j.func,onLastUploadFail:j.func,onLastUploadCancel:j.func,onMount:j.func,onUploadError:j.func},getDefaultProps:function(){return {actionURI:c('MercuryConfig').upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:c('emptyFunction'),onAllUploadsComplete:c('emptyFunction'),onLastUploadFail:c('emptyFunction'),onLastUploadCancel:c('emptyFunction')};},shouldComponentUpdate:function(l,m){return l.actionURI!=this.props.actionURI||l.disabled!==this.props.disabled;},componentDidMount:function(){if(this.props.onMount)this.props.onMount(this);},componentDidUpdate:function(l,m){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function(){var l=this.props.imagesOnly?i._("\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e"):i._("\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b\u044b"),m=c('joinClasses')("_4q61"+(!this.props.customUI?' '+"_5f0v":'')+(!this.props.customUI?' '+"_509v":''),this.props.linkClassName);return (c('React').createElement('form',{action:this.props.actionURI,className:"_vzk",title:l,method:'post',onClick:function(n){n.stopPropagation();if(this.props.disabled)n.preventDefault();}.bind(this),ref:'form'},c('React').createElement('input',{type:'hidden',name:'attach_id',ref:'attachID'}),c('React').createElement('input',{type:'hidden',name:'images_only',value:this.props.imagesOnly}),c('React').createElement(c('InlineBlock.react'),{onClick:this._bootloadChatAutoSendPhotoUploader,className:c('joinClasses')(this.props.className,"_m _4q60 _3rzn")},c('React').createElement('input',{disabled:this.props.disabled,type:'file',className:"_n _2__f",name:'attachment[]',multiple:'true',accept:this.props.imagesOnly?'image/*':'*',ref:'input',title:l}),c('React').createElement(c('Link.react'),{className:m,tabIndex:-1},c('React').createElement('i',{className:this.props.imageClassName,alt:i._("\u041a\u0430\u043c\u0435\u0440\u0430")})))));},_handleSubmit:function(l,m){this.props.onSubmit(l,m);},_handleAllUploadsCompleted:function(l,m){this.props.onAllUploadsComplete(l,m);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function(l,m){this.props.onLastUploadFail(l,m);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function(l,m){this.props.onLastUploadCancel(l,m);if(!this.isMounted())this._cleanup();},_handleUploadError:function(l,m){this.props.onUploadError(m);if(!this.isMounted())this._cleanup();},isUploading:function(){return (this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving);},_bootloadChatAutoSendPhotoUploader:function(){if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new (c('Promise'))(function(l){c('Bootloader').loadModules(["ChatAutoSendPhotoUploader"],function(m){this._uploaderPromiseIsResolving=false;this._uploader=new m(c('ReactDOM').findDOMNode(this.refs.form),c('ReactDOM').findDOMNode(this.refs.input),c('ReactDOM').findDOMNode(this.refs.attachID),c('MercuryConfig').msgr_region);this._uploader.setAllowCrossPage(this.props.allowCrossPage);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled),this._uploader.subscribe('file-upload-error',this._handleUploadError));l(this._uploader);}.bind(this));}.bind(this));}return this._uploaderPromise;},uploadFiles:function(l){this._bootloadChatAutoSendPhotoUploader().then(function(m){m.uploadFiles(l);});},uploadURL:function(l){this._bootloadChatAutoSendPhotoUploader().then(function(m){m.uploadURL(l);});},_cleanup:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});f.exports=k;},null);
__d('StickerContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','MercuryConfig','ReactAbstractContextualDialog','ReactLayer'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=7,j=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal')],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:i,length:16}}}));j.WIDTH={NORMAL:312,WIDE:400};f.exports=j;},null);
__d('ChatStickerButton.react',['cx','fbt','BootloadOnRender.react','ChatFlyoutPlaceholder.react','JSResource','LazyComponent.react','Link.react','MercuryConfig','React','ReactLayeredComponentMixin','StickerActions','StickerContextualDialog.react','StickerStateStore','StoreAndPropBasedStateMixin','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=278,l=c('React').createClass({displayName:'ChatStickerButton',_clickGuard:false,mixins:[c('ReactLayeredComponentMixin'),c('StoreAndPropBasedStateMixin')(c('StickerStateStore'))],propTypes:{className:j.string,ContextualDialogClass:j.func.isRequired,disabled:j.bool,flyoutClassName:j.string,flyoutWidth:j.number,getInput:j.func,onLoad:j.func,onStickerSelect:j.func.isRequired,onEmoticonSelect:j.func.isRequired,onFlyoutShown:j.func,onFlyoutHidden:j.func,threadID:j.string},statics:{calculateState:function(m){var n=c('StickerStateStore').getState();return {shown:n.showTray&&m.threadID===n.threadID};}},getDefaultProps:function(){return {ContextualDialogClass:c('StickerContextualDialog.react'),disabled:false,flyoutWidth:k,onStickerSelect:c('emptyFunction'),onEmoticonSelect:c('emptyFunction')};},componentDidMount:function(){this.props.onLoad&&this.props.onLoad(this);},componentDidUpdate:function(m,n){var o=this.state&&this.state.shown;if(o!==n.shown)if(o){this.props.onFlyoutShown&&this.props.onFlyoutShown();}else this.props.onFlyoutHidden&&this.props.onFlyoutHidden();},componentWillUnmount:function(){if(this.state.shown)this._hideFlyout();},shouldComponentUpdate:function(m,n){return this.props.disabled!==m.disabled||this.state.shown!==n.shown;},render:function(){var m=c('MercuryConfig').MessengerNewEmojiGK?i._("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u0430\u043a\u043b\u0435\u0439\u043a\u0443"):i._("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u0430\u043a\u043b\u0435\u0439\u043a\u0443 \u0438\u043b\u0438 \u0441\u043c\u0430\u0439\u043b\u0438\u043a");return (c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onClick:this.showFlyout,onMouseDown:this._prepareForClick,role:'button',title:m,ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {};var m=this.props.ContextualDialogClass;return {contextualDialog:c('React').createElement(m,{alignment:this.props.flyoutAlignment,className:"_5e-r",contextRef:function(){return this.refs.link;}.bind(this),onBeforeHide:this._handleBeforeHide,onBlur:this._hideFlyout,position:'above',shown:this.state.shown,width:this.props.flyoutWidth},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:this.props.flyoutClassName,onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,shown:this.state.shown}),loader:c('JSResource')('StickersFlyout.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)}))};},_prepareForClick:function(){this._clickGuard=this.state.shown;},showFlyout:function(m){m&&m.stopPropagation();if(this._clickGuard||this.props.disabled){this._clickGuard=false;return;}c('StickerActions').showStickerTray(this.props.threadID);},_handleBeforeHide:function(){if(this.state.shown){this._hideFlyout();return false;}},_hideFlyout:function(){var m=this.props.getInput&&this.props.getInput();m&&m.focus&&m.focus();c('StickerActions').hideStickerTray();},_handleStickerSelected:function(m){this.props.onStickerSelect(m);},_handleEmoticonSelected:function(m){this._hideFlyout();this.props.onEmoticonSelect(m);}});f.exports=l;},null);
__d('MessengerHotLikeOutlineSVG.react',['cssVar','cx','fbt','React','MercuryShareAttachmentRenderLocations','joinClasses','uniqueID','UserAgent'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l='transparent',m=j._("\u0417\u043d\u0430\u0447\u043e\u043a \u00ab\u041f\u0430\u043b\u0435\u0446 \u0432\u0432\u0435\u0440\u0445\u00bb"),n=c('React').createClass({displayName:'MessengerHotLikeOutlineSVG',propTypes:{color:k.string,location:k.string},getInitialState:function(){return {titleId:c('uniqueID')()};},render:function(){var o=this.props.color||"#0084ff",p=void 0;if(this.props.location!==c('MercuryShareAttachmentRenderLocations').CHAT)p={paddingTop:c('UserAgent').isBrowser('IE')?'0':'16%',width:'66%'};return (c('React').createElement('svg',{'aria-labelledby':this.state.titleId,version:'1.1',viewBox:'-1 -1 40.16 42.24',style:p},c('React').createElement('title',{id:this.state.titleId},m),c('React').createElement('path',{d:'M935.36,1582.44a0,0,0,0,0,0,.06,3.59,3.59,0,0,1-.72,6.53,0,0,0,0,0,0,0,3.56,3.56,0,0,1,.71,2.13,3.6,3.6,0,0,1-3,3.54, 0,0,0,0,0,0,.05,3.56,3.56,0,0,1,.38,1.61,3.61,3.61,0,0,1-3.42,3.6H910v-19.6l5.27-7.9a4,4,0,0,0,.66-2.31l-0.1-4c-0.22-2.4-.09-2.06, 1.13-2.37,2-.51,7.16,1.59,5.13,12.17h11.06A3.59,3.59,0,0,1,935.36,1582.44ZM899,1581h7v22h-7v-22Z',transform:'translate(-898.5 -1563.26)',fill:l,fillRule:'evenodd',stroke:o,strokeLinecap:'round',strokeWidth:'5%'})));}});f.exports=n;},null);
__d('MessengerHotLikeButton.react',['cx','fbt','EmojiLikeConstants','Image.react','ImmutableObject','Keys','KeyStatus','Link.react','MercuryConfig','MercuryMessageObject','MercurySourceType','MessengerHotLikePreviewEvents','MessengerHotLikeOutlineSVG.react','MessengerHotLikeUtils','ReactComponentWithPureRenderMixin','React','StickerActions','StickerConstants','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('MercuryMessageObject').get(),k=c('React').PropTypes,l=c('React').createClass({displayName:'MessengerHotLikeButton',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{onMouseDown:k.func,customLike:k.object,customColor:k.string,location:k.string,sendSticker:k.func.isRequired,sendCustomLike:k.func,threadID:k.string.isRequired,disabled:k.bool,renderSize:k.number},_popTimeout:null,_pressedSince:null,_subscription:null,componentDidMount:function(){this._subscription=c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(m,n,o){if(m===this.props.threadID)if(o&&this.props.customLike&&this.props.sendCustomLike){this.props.sendCustomLike(this.props.customLike,o);}else this.props.sendSticker(n);}.bind(this));},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){var m=null,n={};if(this.props.customLike!=null){if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerNewEmojiUtils){var o=this.props.customLike.emoji,p=c('MercuryConfig').MessengerNewEmojiUtils.getNewEmojiData(o,c('EmojiLikeConstants').size.SMALL),q=this.props.renderSize?this.props.renderSize:16;n.background='none';m=c('React').createElement(c('Image.react'),{src:p.url,style:{padding:q==16?0:3,display:'block',height:q,width:q}});}else{o=this.props.customLike.medium;if(o){n.background='none';m=c('React').createElement(c('Image.react'),{src:o,style:{display:'block',height:16,width:16}});}}}else if(this.props.customColor)m=c('React').createElement(c('MessengerHotLikeOutlineSVG.react'),{color:this.props.customColor,location:this.props.location});return (c('React').createElement(c('Link.react'),{'aria-label':i._("\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u00ab\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f\u00bb"),className:c('joinClasses')(this.props.customColor?"_5j_u":'',this.props.className),disabled:this.props.disabled,href:'#',onClick:this._handleClickEvent,onDragStart:function(r){return r.preventDefault();},onMouseDown:this._handleMouseDown,onMouseLeave:this._cancelSend,onMouseUp:this._handleMouseUp,role:'button',style:n,title:i._("\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u00ab\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f\u00bb")},m));},_handleMouseDown:function(m){if(this.props.disabled||this._pressedSince){m.preventDefault();m.stopPropagation();}if(this.props.disabled||m.button!==0)return;c('StickerActions').hideStickerTray();this.props.onMouseDown&&this.props.onMouseDown();this._pressedSince=Date.now();this._informPreviewStart();this._preparePop();},_handleMouseUp:function(){if(!(this.props.threadID&&this._pressedSince))return;this._pressedSince=0;this._cancelPop();this._informPreviewStop();},_informPreviewStart:function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').START,this._getFakeMessage(),this.props.threadID);},_informPreviewStop:function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);},_informPreviewPop:function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').POP,this.props.threadID);},_getFakeMessage:function(){var m=j.constructStickerMessageObject(c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID,c('MercurySourceType').MESSENGER_WEB,this.props.threadID);j.normalizeNewMessage(m);m.is_like_preview=true;m.like_preview_since=this._pressedSince;m.customLike=this.props.customLike;m.body='';return new (c('ImmutableObject'))(m);},_preparePop:function(){this._cancelPop();this._popTimeout=setTimeout(this._informPreviewPop,c('MessengerHotLikeUtils').SizeTimes.large);},_cancelSend:function(){if(this._pressedSince){this._pressedSince=0;this._cancelPop();this._informPreviewPop();}},_cancelPop:function(){clearTimeout(this._popTimeout);},_handleClickEvent:function(m){m.stopPropagation();if(this.props.disabled)return;if(c('KeyStatus').getKeyDownCode()===c('Keys').RETURN||!this.props.threadID){var n=this.props.sendCustomLike;if(this.props.customLike&&n){n(this.props.customLike,c('MessengerHotLikeUtils').getEmojiSizeForTime(1));}else this.props.sendSticker(c('MessengerHotLikeUtils').getStickerIDForTime(1));}}});f.exports=l;},null);
__d('ChatTabComposer.react',['csx','cx','fbt','ChatConfig','ChatContentSearchButton.react','ChatEmojiButton.react','ChatInputBasic.react','ChatInput.react','ChatPhotoUploader.react','ChatStickerButton.react','CSS','JSResource','MercuryConfig','MessengerHotLikeButton.react','P2PSendMoneyContainerBootloader.react','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','StickerActions'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=77,m=c('React').createClass({displayName:'ChatTabComposer',_fileUploader:null,_photoUploader:null,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{initializeThingsWithInputFn:k.func,inputKeyDown:k.func,onBlur:k.func,onEmojiSelect:k.func,onEscape:k.func,onFocus:k.func,onTab:k.func,p2pProps:k.object,participantIDs:k.arrayOf(k.string),photoUploaderProps:k.object,placeHolder:k.string,resizeFn:k.func,showP2PButton:k.bool,stickerButtonProps:k.object,uploadPhotoFn:k.func},getInitialState:function(){return {inputHeight:0,stickerFlyoutShown:false};},render:function(){return (c('React').createElement('div',{className:"_1d4_",onClick:this._handleClick},this._renderInput(),c('React').createElement('div',{className:"_552n"},this._renderIcons())));},resetInput:function(){this.refs.input.resetState();},uploadURL:function(n){if(!this._fileUploader)return;this._fileUploader.uploadURL(n);},isUploading:function(){return !!(this._fileUploader&&this._fileUploader.isUploading()||this._photoUploader&&this._photoUploader.isUploading());},getInput:function(){return this.refs.input;},_renderInput:function(){var n={};if(this.state.inputHeight)n.minHeight=this.state.inputHeight;var o=c('ChatConfig').get('chat_basic_input')?c('ChatInputBasic.react'):c('ChatInput.react');return (c('React').createElement('div',{className:"_552h",style:n},c('React').createElement(o,{initializeThingsWithInputFn:this.props.initializeThingsWithInputFn,inputKeyDown:this.props.inputKeyDown,onBlur:this.props.onBlur,onEscape:this._handleEscape,onFocus:this.props.onFocus,onTab:this.props.onTab,ref:'input',resizeFn:function(p){p=Math.min(p,l);this.setState({inputHeight:p});this.props.resizeFn&&this.props.resizeFn(p);}.bind(this),uploadPhotoFn:function(p){this._photoUploader&&this._photoUploader.uploadFiles([p]);}.bind(this),placeholder:this.props.placeholder})));},_renderIcons:function(){return [this._renderPhotoUploader(),this._renderStickerButton(),this._renderContentSearchButton(),this._renderEmojiButton(),this._renderP2PButton(),this._renderFileUploader(),this._renderLikeButton()];},_renderPhotoUploader:function(){var n=this.props.photoUploaderProps||{};return (c('React').createElement(c('ChatPhotoUploader.react'),babelHelpers['extends']({key:'photos',onMount:function(o){return this._photoUploader=o;}.bind(this)},n)));},_renderFileUploader:function(){var n=this.props.fileUploaderProps||{};return (c('React').createElement(c('ChatPhotoUploader.react'),babelHelpers['extends']({key:'files',onMount:function(o){return this._fileUploader=o;}.bind(this)},n)));},_renderStickerButton:function(){var n=this.props.stickerButtonProps;if(!n)return null;return (c('React').createElement('div',{className:"_6gd",key:'stickers'},c('React').createElement(c('ChatStickerButton.react'),babelHelpers['extends']({},n,{onFlyoutShown:function(){this.refs.input.focus();this.setState({stickerFlyoutShown:true});}.bind(this),onFlyoutHidden:function(){this.setState({stickerFlyoutShown:false});}.bind(this)}))));},_renderContentSearchButton:function(){if(!c('ChatConfig').get('chat_content_search'))return null;return (c('React').createElement('div',{className:"_6gd",key:'contentsearch'},c('React').createElement(c('ChatContentSearchButton.react'),{className:"_6gb _6gs",getQuery:function(){return this.refs.input.getValue();}.bind(this),onSelect:this._handleContentSearchSelect})));},_renderEmojiButton:function(){if(!c('ChatConfig').get('www_messenger_emoji_picker'))return null;return (c('React').createElement('div',{className:"_6gd",key:'emojipicker'},c('React').createElement(c('ChatEmojiButton.react'),{className:"_6gb _3oxr",onSelect:this.props.onEmojiSelect})));},_renderLikeButton:function(){if(!c('ChatConfig').get('hotlike'))return null;var n=c('MercuryConfig').CustomColorChatTabGK?this.props.thread&&this.props.thread.custom_color:'',o=(!n?"_6h1":'')+(' '+"_6gb");return (c('React').createElement('div',{className:"_6gd _5ep3",key:'like'},c('React').createElement(c('MessengerHotLikeButton.react'),{className:o,customColor:n,customLike:this.props.thread&&this.props.thread.custom_like_icon,location:c('MercuryShareAttachmentRenderLocations').CHAT,sendSticker:this.props.onStickerSelect,sendCustomLike:this.props.onCustomLikeSelect,threadID:this.props.threadID})));},_renderP2PButton:function(){if(!this.props.p2pProps||!this.props.showP2PButton)return null;var n=this.props.p2pProps;n.threadID=this.props.threadID;if(this.props.participantIDs&&this.props.participantIDs.length)n.participantIDs=this.props.participantIDs;return (c('React').createElement('div',{className:"_6gd",key:'p2p'},c('React').createElement(c('P2PSendMoneyContainerBootloader.react'),n)));},_handleClick:function(n){if(c('CSS').matchesSelector(n.target,"._1d4_")||c('CSS').matchesSelector(n.target,"._552h")||c('CSS').matchesSelector(n.target,"._552n"))this.refs.input.focus();},_handleEscape:function(n){if(this.state.stickerFlyoutShown)return c('StickerActions').hideStickerTray();this.props.onEscape&&this.props.onEscape(n);},_handleContentSearchSelect:function(n,o){if(n.platformFBID.toString()!==c('MercuryConfig').MessengerAppID){this.uploadURL({attribution_app_id:n.platformFBID,errorDialogParams:{body:j._("\u041f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0444\u0430\u0439\u043b\u0430 GIF \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0440\u0443\u0433\u043e\u0439 \u0444\u0430\u0439\u043b \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),title:j._("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b GIF.")},external_image_url:n.source.url,preview_url:n.media.preview?n.media.preview.url:n.media.thumbnail.url,source:n.source});}else this.props.onStickerSelect&&this.props.onStickerSelect(n.resultID.toString);}});f.exports=m;},null);
__d('ChatTabComposerContainer.react',['cx','fbt','ChatTabComposer.react','MercuryIDs','MercuryThreads','MercuryMessageActions','P2PGKValues','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','SimpleXUIDialog','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='right',k=c('React').PropTypes,l=c('React').createClass({displayName:'ChatTabComposerContainer',mixins:[c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(c('MercuryThreads'))],propTypes:{threadID:k.string,viewer:k.string.isRequired,onEmoticonSelect:k.func,onFileUploadFail:k.func,onPhotoUploadFail:k.func,onStickerSelect:k.func,onUploadCancel:k.func,onUploadComplete:k.func,onUploadSubmit:k.func},statics:{calculateState:function(m){var n=c('MercuryThreads').getForFBID(m.viewer),o=m.threadID?n.getOrFetch(m.threadID):null,p=c('P2PGKValues').P2PVisible&&m.viewer!==c('MercuryIDs').getUserIDFromThreadID(m.threadID);return {thread:o,showP2PButton:p,participantIDs:[],placeholder:m.placeholder};}},componentDidMount:function(){this.props.onMount(this);},render:function(){return (c('React').createElement(c('ChatTabComposer.react'),babelHelpers['extends']({fileUploaderProps:this._getFileUploaderProps(),ref:'composer',thread:this.state.thread},this.props,{p2pProps:this._getP2PProps(),participantIDs:this.state.participantIDs,photoUploaderProps:this._getPhotoUploaderProps(),placeholder:this.state.placeholder,showP2PButton:this.state.showP2PButton,stickerButtonProps:this._getStickerButtonProps()})));},onSend:function(){this.refs.composer.resetInput();},setPlaceholder:function(m){this.setState({placeholder:m});},setParticipantIDs:function(m){m=m||[];this.setState({participantIDs:m});},getInput:function(){return this.refs.composer.getInput();},isUploading:function(){return this.refs.composer.isUploading();},_getP2PProps:function(){if(!this.state.showP2PButton)return {};return {button:c('React').createElement('i',{className:"hidden_elem"}),className:"_6ga _6gb",flyoutAlignment:j,referrer:c('MercuryShareAttachmentRenderLocations').CHAT,threadID:this.props.threadID,onTrigger:this.props.onP2PTrigger};},_getStickerButtonProps:function(){var m={className:"_6gb _6gf",flyoutAlignment:j,threadID:this.props.threadID,onEmoticonSelect:this.props.onEmoticonSelect,onStickerSelect:this.props.onStickerSelect};return m;},_getPhotoUploaderProps:function(){var m={className:"_6gd",customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",onLastUploadCancel:this._handleUploadCancel,onAllUploadsComplete:this._handleUploadComplete,onLastUploadFail:this._handlePhotoUploadFail,onSubmit:this._handleUploadSubmit};return m;},_getFileUploaderProps:function(){var m=this._getPhotoUploaderProps();m.linkClassName="_6gb _6gg";m.imagesOnly=false;m.onLastUploadFail=this._handleFileUploadFail;return m;},_handleUploadComplete:function(m,n){c('MercuryMessageActions').getForFBID(this.props.viewer).confirmAttachmentPlaceholder(n.upload_id,n);this.props.onUploadComplete&&this.props.onUploadComplete(n);},_handleUploadCancel:function(m,n){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(n.upload_id,n);this.props.onUploadCancel&&this.props.onUploadCancel(n);},_handleFileUploadFail:function(m,n){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(n.upload_id,n);var o=i._("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b"),p=i._("\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443. \u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0444\u0430\u0439\u043b\u0430 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430.");if(n.errorDialogParams){o=n.errorDialogParams.title||o;p=n.errorDialogParams.body||p;}this._showErrorDialog(o,p);this.props.onFileUploadFail&&this.rops.onFileUploadFail(n);},_handlePhotoUploadFail:function(m,n){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(n.upload_id,n);var o=i._("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438 \u043d\u0435 \u0443\u0434\u0430\u043b\u0430\u0441\u044c"),p=i._("\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437. \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0435 \u043f\u0440\u0438\u0433\u043e\u0434\u043d\u0443\u044e \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e.");if(n.errorDialogParams){o=n.errorDialogParams.title||o;p=n.errorDialogParams.body||p;}this._showErrorDialog(o,p);this.props.onPhotoUploadFail&&this.rops.onPhotoUploadFail(n);},_handleUploadSubmit:function(m,n){this.props.onUploadSubmit&&this.props.onUploadSubmit(n);},_showErrorDialog:function(m,n){c('SimpleXUIDialog').show(n,m);}});f.exports=l;},null);
__d('ChatTabSheetListener',['invariant','ChatPrivacyActionController','MercuryIDs','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MercuryViewer'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){this.$ChatTabSheetListener1=k;this.$ChatTabSheetListener3=j;this.$ChatTabSheetListener4=c('MercuryIDs').getUserIDFromThreadID(this.$ChatTabSheetListener3);c('MercuryThreadInformer').get().subscribe('threads-updated',function(){return this.$ChatTabSheetListener5();}.bind(this));if(this.$ChatTabSheetListener4)this.$ChatTabSheetListener2=new (c('ChatPrivacyActionController'))(this.$ChatTabSheetListener4,function(l){return this.$ChatTabSheetListener6(l);}.bind(this));}i.prototype.destroy=function(){this.$ChatTabSheetListener2&&this.$ChatTabSheetListener2.destroy();};i.prototype.$ChatTabSheetListener5=function(){var j=c('MercuryThreads').get();j.getThreadMeta(this.$ChatTabSheetListener3,function(k){var l=c('MercuryViewer').getID(),m=k.participants.filter(function(n){return n!==l;});m.length<1&&!j.isNewEmptyLocalThread(this.$ChatTabSheetListener3)?this.$ChatTabSheetListener1.openNoRecipientsSheet():this.$ChatTabSheetListener1.closeNoRecipientsSheet();}.bind(this));};i.prototype.$ChatTabSheetListener6=function(j){switch(j){case c('ChatPrivacyActionController').OFFLINE:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.openOfflineSheet();break;case c('ChatPrivacyActionController').NORMAL:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.closeOfflineSheet();break;case c('ChatPrivacyActionController').BLOCKED:this.$ChatTabSheetListener1.closeOfflineSheet();!!!this.$ChatTabSheetListener4?h(0):void 0;c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(this.$ChatTabSheetListener4),function(k){k.is_friend?this.$ChatTabSheetListener1.openUserBlockedSheet():this.$ChatTabSheetListener1.closeUserBlockedSheet();}.bind(this));break;}};f.exports=i;},null);
__d('ChatTabSheetController',['Bootloader','ChatTabSheetListener','Deferred','MercuryIDs'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(i,j,k,l){this._threadID=i;this._rootElement=j;this._tabElement=k;this._view=l;this._deferred=new (c('Deferred'))();this._isLoading=false;this._listener=new (c('ChatTabSheetListener'))(this._threadID,this);};Object.assign(h.prototype,{openAddFriendsSheet:function(){this._load(function(){this._addFriendsTabSheet.open();}.bind(this));},openMessageBlockedTabSheet:function(){this._load(function(){this._threadIsMessageBlockedSheet.open();}.bind(this));},getAddFriendsParticipants:function(){return this._addFriendsTabSheet?this._addFriendsTabSheet.getParticipants():[];},openNameConversationSheet:function(i){this._load(function(){this._nameConversationTabSheet.open(i);}.bind(this));},openReadOnlySheet:function(){this._load(function(){this._readOnlyTabSheet.open();}.bind(this));},openNewMessagesSheet:function(){this._load(function(){this._newMessagesTabSheet.open();}.bind(this));},openUploadWarningTabSheet:function(){this._load(function(){this._uploadWarningTabSheet.open();}.bind(this));},openThreadIsMutedTabSheet:function(){this._load(function(){this._threadIsMutedTabSheet.open();}.bind(this));},openEmployeeAwaySheet:function(){this._load(function(){this._employeeAwaySheet.open();}.bind(this));},openOfflineSheet:function(){this._load(function(){this._offlineTabSheet.open();}.bind(this));},openUserBlockedSheet:function(){this._load(function(){this._userBlockedTabSheet.open();}.bind(this));},openNoRecipientsSheet:function(){this._load(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.open();}.bind(this));},openSecretModeSheet:function(){this._load(function(){this._secretModeSheet.open();}.bind(this));},closeAddFriendsSheet:function(){this._lazy(function(){this._addFriendsTabSheet.close();}.bind(this));},closeAutomaticNameConversationSheet:function(){this._lazy(function(){if(this._nameConversationTabSheet&&this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();}.bind(this));},closeMessageBlockedTabSheet:function(){this._lazy(function(){this._threadIsMessageBlockedSheet.close();}.bind(this));},closeThreadIsMutedTabSheet:function(){this._lazy(function(){this._threadIsMutedTabSheet.close();}.bind(this));},closeNewMessagesSheet:function(){this._lazy(function(){this._newMessagesTabSheet.close();}.bind(this));},closeUploadWarningTabSheet:function(){this._lazy(function(){this._uploadWarningTabSheet.close();}.bind(this));},closeOfflineSheet:function(){this._lazy(function(){this._offlineTabSheet.close();}.bind(this));},closeUserBlockedSheet:function(){this._lazy(function(){this._userBlockedTabSheet.close();}.bind(this));},closeSecretModeSheet:function(){this._lazy(function(){this._secretModeSheet.close();}.bind(this));},onClickMessagesBlockedSheet:function(i){this._lazy(function(){this._unblockMessagesSub=this._threadIsMessageBlockedSheet.subscribe('clicked',i);}.bind(this));},closeNoRecipientsSheet:function(){this._lazy(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.close();}.bind(this));},onClickNewMessagesSheet:function(i){this._lazy(function(){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',i);}.bind(this));},onClickThreadIsMutedSheet:function(i){this._lazy(function(){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',i);}.bind(this));},onClickSecretModeSheet:function(i){this._lazy(function(){this._secretModeClickSub=this._secretModeSheet.subscribe('clicked',i);}.bind(this));},onResize:function(i){this._lazy(function(){this._sheetView.subscribe('resize',i);}.bind(this));},onTokensChanged:function(i){this._lazy(function(){this._addFriendsTabSheet.subscribe('chat/tokens-changed',i);}.bind(this));},onEscape:function(i){this._lazy(function(){this._addFriendsTabSheet.subscribe('esc-pressed',i);}.bind(this));},destroy:function(){this._listener&&this._listener.destroy();this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();},_load:function(i){this._bootload();this._deferred.then(i);},_lazy:function(i){this._deferred.then(i);},_bootload:function(){if(this._isLoading)return;this._isLoading=true;c('Bootloader').loadModules(["ChatAddFriendsTabSheet","ChatEmployeeAwaySheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMessageBlockedSheet","ChatThreadIsMutedTabSheet","ChatThreadSecretModeSheet","ChatUploadWarningTabSheet","ChatUserBlockedTabSheet","MercurySheetView"],function(i,j,k,l,m,n,o,p,q,r,s,t,u){this._sheetView=new u(this._threadID,this._rootElement,this._tabElement);var v=this._threadID,w=this._rootElement,x=this._sheetView,y=this._view;this._addFriendsTabSheet=new i(v,w,x,y);this._employeeAwaySheet=new j(v,w,x);this._nameConversationTabSheet=new k(v,w,x);this._newMessagesTabSheet=new l(v,w,x);this._offlineTabSheet=new n(v,w,x);this._readOnlyTabSheet=new o(v,w,x);this._threadIsMessageBlockedSheet=new p(v,w,x);this._threadIsMutedTabSheet=new q(v,w,x);this._secretModeSheet=new r(v,w,x);this._uploadWarningTabSheet=new s(v,w,x);this._userBlockedTabSheet=new t(v,w,x);if(!c('MercuryIDs').getUserIDFromThreadID(this._threadID))this._noRecipientsTabSheet=new m(v,w,x);this._deferred.resolve();}.bind(this));}});f.exports=h;},null);
__d('ChatTitleLink.react',['cx','ChatEditParticipantsUtils','Link.react','MercuryConfig','MercuryThreads','MercuryThreadTitle.react','React','TrackingNodes','UserAgent'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreads').get(),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatTitleLink',propTypes:{href:j.string,thread:j.object,viewer:j.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (c('React').createElement(c('Link.react'),{'aria-level':'3',className:"titlebarText"+(c('UserAgent').isBrowser('Chrome')&&!c('UserAgent').isPlatform('Windows')?' '+"fixemoji":'')+(this.props.href===null?' '+"noLink":''),'data-ft':c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.TITLE),'data-hover':'tooltip',onClick:function(l){return this._handleClick(l);}.bind(this),href:this.props.href},c('React').createElement(c('MercuryThreadTitle.react'),{ref:'threadTitle',isNewThread:i.isNewEmptyLocalThread(this.props.thread.thread_id),thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));},_handleClick:function(l){if(c('MercuryConfig').AdminV1MasterGK&&!this.props.thread.is_canonical&&!i.isEmptyLocalThread(this.props.thread.thread_id)){c('ChatEditParticipantsUtils').showParticipantsModal(this.props.thread.thread_id);l.preventDefault();}}});f.exports=k;},null);
__d("XMNCommercePostbackCTAController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/postback\/",{cta_id:{type:"String",required:true}});},null);
__d('MNCommercePostbackCTADataManager',['AsyncRequest','XMNCommercePostbackCTAController'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.prototype.send=function(i){var j=c('XMNCommercePostbackCTAController').getURIBuilder().setString('cta_id',i).getURI();new (c('AsyncRequest'))().setURI(j).setMethod('post').send();};function h(){}f.exports=new h();},null);
__d('MercuryCanonicalGroupThreadManager',['KeyedCallbackManager','MercuryIDs','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new (c('KeyedCallbackManager'))();this.$MercuryCanonicalGroupThreadManager3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4=c('MercuryThreads').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager5();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);var l=this.$MercuryCanonicalGroupThreadManager6(j);this.$MercuryCanonicalGroupThreadManager2.setResource(l,undefined);var m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager7(j);return m;};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j);};h.prototype.$MercuryCanonicalGroupThreadManager6=function(j){return j.sort().join(',');};h.prototype.$MercuryCanonicalGroupThreadManager8=function(j,k){var l=c('MercuryIDs').getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);};h.prototype.$MercuryCanonicalGroupThreadManager7=function(j){var k={canonical_group_key:this.$MercuryCanonicalGroupThreadManager6(j),participants:j};c('MercuryServerDispatcher').trySend('/ajax/mercury/search_canonical_groups.php',k,null,this.$MercuryCanonicalGroupThreadManager1);};h.prototype.$MercuryCanonicalGroupThreadManager5=function(){c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(j){this.handleUpdate(j);}.bind(this)}});};h.prototype.handleUpdate=function(j){if(j.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(j.mercury_payload);var k=j.canonical_group;if(k)for(var l in k)this.$MercuryCanonicalGroupThreadManager8(l,k[l]);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d("XPagesMercuryIndicatorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});},null);
__d('PagesMercuryChatTabIndicatorHandler',['Animation','AsyncRequest','AvailableListConstants','DOM','FBID','MercuryIDs','XPagesMercuryIndicatorController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();h.tryCreateHandler=function(i,j,k){'use strict';if(!j)return null;var l=c('MercuryIDs').getUserIDFromThreadID(i);if(!l||c('FBID').isUser(l))return null;return new h(l,j,k);};function h(i,j,k){'use strict';this.$PagesMercuryChatTabIndicatorHandler2=false;this.$PagesMercuryChatTabIndicatorHandler3=j;this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler5=false;this.$PagesMercuryChatTabIndicatorHandler6=k;this.$PagesMercuryChatTabIndicatorHandler7=false;this.$PagesMercuryChatTabIndicatorHandler8=i;}h.prototype.__getEnableTimeSwitch=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler2;};h.prototype.__getIndicator=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler3;};h.prototype.__getIsShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler5;};h.prototype.__getPageOnlineStatus=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler6;};h.prototype.__getShouldPreventFutureShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler7;};h.prototype.__getTargetID=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler8;};h.prototype.__getIsChecking=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler4;};h.prototype.__getResponsivenessDescription=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler1;};h.prototype.checkResponsiveness=function(){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler4)return;var i=c('XPagesMercuryIndicatorController').getURIBuilder().getURI();this.$PagesMercuryChatTabIndicatorHandler4=true;new (c('AsyncRequest'))().setURI(i).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler8}).setHandler(function(j){this.$PagesMercuryChatTabIndicatorHandler4=false;var k=j.payload;if(k.responsiveness)this.$PagesMercuryChatTabIndicatorHandler9(k.responsiveness,k.enableTimeSwitch);}.bind(this)).send();};h.prototype.hideIndicator=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(false);};h.prototype.hideIndicatorAndPreventFutureShow=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(true);};h.prototype.$PagesMercuryChatTabIndicatorHandler10=function(i){'use strict';this.$PagesMercuryChatTabIndicatorHandler7=this.$PagesMercuryChatTabIndicatorHandler7||i;if(this.$PagesMercuryChatTabIndicatorHandler3&&this.$PagesMercuryChatTabIndicatorHandler5){this.$PagesMercuryChatTabIndicatorHandler5=false;new (c('Animation'))(this.$PagesMercuryChatTabIndicatorHandler3).to('height',0).duration(100).hide().go();}};h.prototype.showIndicator=function(){'use strict';if(!this.$PagesMercuryChatTabIndicatorHandler3||this.$PagesMercuryChatTabIndicatorHandler5||this.$PagesMercuryChatTabIndicatorHandler6!==c('AvailableListConstants').OFFLINE||!this.$PagesMercuryChatTabIndicatorHandler1||this.$PagesMercuryChatTabIndicatorHandler7)return;c('DOM').setContent(this.$PagesMercuryChatTabIndicatorHandler3,this.$PagesMercuryChatTabIndicatorHandler1);this.$PagesMercuryChatTabIndicatorHandler5=true;new (c('Animation'))(this.$PagesMercuryChatTabIndicatorHandler3).show().to('height',16).duration(100).go();};h.prototype.notifyPageOnlineStatusChanged=function(i){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler6===i)return;this.$PagesMercuryChatTabIndicatorHandler6=i;if(!this.$PagesMercuryChatTabIndicatorHandler2)return;switch(i){case c('AvailableListConstants').ACTIVE:this.hideIndicator();break;default:this.showIndicator();break;}};h.prototype.$PagesMercuryChatTabIndicatorHandler9=function(i,j){'use strict';this.$PagesMercuryChatTabIndicatorHandler1=i;this.$PagesMercuryChatTabIndicatorHandler2=j;this.showIndicator();};f.exports=h;},null);
__d("XMNCommercePageNullStateCTAController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/page\/nullstate\/",{});},null);
__d('ChatTabView',['csx','cx','fbt','Promise','AsyncRequest','AsyncSignal','AvailableListConstants','BootloadedComponent.react','Bootloader','ChatBehavior','ChatConfig','ChatNubLogger','ChatOpenTab','ChatTabActions','ChatTabComposerContainer.react','ChatTabMessagesView','ChatTabSheetController','ChatTabViewEvents','ChatTabViewInstances','ChatTitleLink.react','ChatVisibility','CSS','CurrentUser','Dock','DOM','DOMQuery','DragDropTarget','EmojiLikeUtils','EmoticonsList','Event','FBID','JSResource','Keys','LogHistory','MercuryBlockedParticipants','MercuryCanonicalGroupThreadManager','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercurySourceType','MercuryThreadInfo','MercuryThreadTitle.react','MercuryTypingAnimation.react','MercuryTypingReceiver','MercuryViewer','MessagingTag','MNCommercePostbackCTADataManager','NubController','PagesMercuryChatTabIndicatorHandler','Parent','PhotosUploadWaterfall','PresenceStatus','React','ReactComponentRenderer','ReactDOM','Run','Scroll','ShortProfiles','SimpleXUIDialog','SiteData','Style','SubscriptionsHandler','SyntheticMouseEvent','ChatTabTemplates','TooltipData','TypingDetectorController','UserAgent_DEPRECATED','WaterfallIDGenerator','WebMessengerThreadPermalinks','WorkFileUploadsGating','WorkModeConfig','createCancelableFunction','emptyFunction','getActiveElement','isEmpty','requireWeak','setIntervalAcrossTransitions','MercuryMessageObject','MercuryMessages','MercuryServerRequests','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInformer','MercuryThreads','MercuryMessageActions','XMNCommercePageNullStateCTAController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryTypingReceiver').get(),l=c('MercuryMessageObject').get(),m=c('MercuryMessages').get(),n=c('MercuryServerRequests').get(),o=c('MercuryThreadActions').get(),p=c('MercuryThreadIDMap').get(),q=c('MercuryThreadInformer').get(),r=c('MercuryThreads').get(),s=c('MercuryMessageActions').get(),t=/^\s*$/,u=c('ChatTabViewInstances'),v=960,w=10,x=c('ChatConfig').get('chat_simple_group_title_tooltip'),y='\n',z=c('ChatConfig').get('chat_messenger_styles')&&c('ChatConfig').get('custom_color_chat_tab'),aa=c('ChatConfig').get('web_messenger_thread_null_state_cta'),ba=c('LogHistory').getInstance('chat_tab_view');c('requireWeak')('AvailableList',function(wa){wa.subscribe(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,ta);});function ca(wa,xa){var ya=c('DOM').create('div'),za=[];xa=xa&&xa.filter(function(cb){return cb!=c('MercuryViewer').getID();});if(c('isEmpty')(xa))return c('TooltipData').remove(wa);var ab=xa.length,bb=ab-w;if(bb>1)xa=xa.slice(0,w);c('MercuryParticipants').getMulti(xa,function(cb){for(var db in cb){var eb=cb[db];if(x){za.push(eb.name);continue;}var fb=c('ChatTabTemplates')[':fb:mercury:chat:multichat-tooltip-item'].build();c('DOM').setContent(fb.getNode('name'),eb.name);var gb=c('MercuryIDs').getUserIDFromParticipantID(db),hb=gb&&c('PresenceStatus').get(gb)==c('AvailableListConstants').ACTIVE;c('CSS').conditionShow(fb.getNode('icon'),hb);c('CSS').conditionClass(fb.getNode('name'),"_1aly",hb);c('DOM').appendContent(ya,fb.getRoot());}if(bb>1){var ib=j._("\u0438 \u0435\u0449\u0435 {number of hidden chat participants}.",[j.param('number of hidden chat participants',bb)]);if(!x){c('DOM').appendContent(ya,c('DOM').create('div',{},ib));}else za.push(ib);}c('TooltipData').set(wa,x?za.join(y):ya,'above');});}var da={},ea=null,fa=false;function ga(wa,xa,ya){if(ya){da[wa]=xa;if(!ea)ea=c('setIntervalAcrossTransitions')(ha,600);}else{c('CSS').removeClass(xa,'highlightTitle');delete da[wa];}}function ha(){for(var wa in da){var xa=da[wa];if(xa.parentNode){c('CSS').conditionClass(xa,'highlightTitle',fa);}else delete da[wa];}fa=!fa;if(!Object.keys(da).length){clearInterval(ea);ea=null;}}function ia(wa){var xa=c('MercuryIDs').tokenize(wa);switch(xa.type){case 'user':return c('ChatTabTemplates')[':fb:mercury:chat:user-tab'].build();}return c('ChatTabTemplates')[':fb:mercury:chat:multichat-tab'].build();}function ja(wa){var xa=wa._getInputValue(),ya=wa._filesUploader,za=ya?ya.getAttachments():[];if(oa(wa))la(wa,xa,za,function(ab){ab=va(ab,ya);s.send(ab,function(bb){var cb=r.getThreadMetaNow(bb);if(cb&&cb.folder===c('MessagingTag').PENDING)o.movePendingToInbox(bb);});ya&&ya.removeAttachments();if(wa._sharePreview)wa._sharePreview.setProps({share:null,uri:null});wa._composer&&wa._composer.onSend();wa._typingDetector&&wa._typingDetector.resetState();if(wa._messagesView){wa._messagesView.scrollToBottom();wa._messagesView.setShouldScrollToBottom(true);wa.tryMarkAsRead();}});}function ka(wa,xa){if(xa===0)return;qa(wa,c('PhotosUploadWaterfall').POST_PUBLISHED,{count:xa});wa._waterfallID=c('WaterfallIDGenerator').generate();}function la(wa,xa,ya,za){r.getThreadMeta(wa._threadID,function(ab){if(ab&&ab.is_canonical&&!c('MercuryThreadInfo').canReply(ab)){wa._showMessageBlockedDialog(ab);return;}var bb=c('MercurySourceType').CHAT_WEB,cb=l.constructUserGeneratedMessageObject(xa,bb,wa._threadID);if(ya.length>0){cb.has_attachment=true;cb.raw_attachments=ya;}if(wa._sharePreview){var db=wa._sharePreview.component.getShareData();if(db){cb.has_attachment=true;cb.shareable_attachment=db;}}if(r.isNewEmptyLocalThread(wa._threadID)){var eb=wa._sheetController.getAddFriendsParticipants();wa._sheetController.closeAddFriendsSheet();if(eb===null||eb.length===0)return;eb=eb.filter(function(ib){return ib!=c('MercuryViewer').getID();});if(eb.length===0){cb.thread_id=c('MercuryIDs').getThreadIDFromUserID(c('CurrentUser').getID());}else if(eb.length===1){cb.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(eb[0]);}else{var fb=wa.getMessagesView().getThreadID();if(fb!=wa._threadID)cb.thread_id=fb;o.addParticipants(wa._threadID,eb);}}if(r.isEmptyLocalThread(wa._threadID)){cb.offline_threading_id=c('MercuryIDs').tokenize(wa._threadID).value;var gb=r.getThreadMetaNow(ab.thread_id);cb.specific_to_list=Array.from(gb.participants);}if(typeof cb!='undefined')cb.signatureID=wa._signatureID;cb.ui_push_phase=c('SiteData').push_phase;za(cb);if(wa._threadID!==cb.thread_id&&!wa.isUploading()){var hb=wa._getInputValue();c('ChatTabActions').closeTab(wa._threadID);c('ChatOpenTab').openThread(cb.thread_id,'ChatTabView',null,xa?c('emptyFunction'):function(ib){return ib.appendTextToInput(hb);});}});}function ma(wa){wa._blocked=true;wa._sheetController.openUploadWarningTabSheet();}function na(wa){return wa.isUploading();}function oa(wa){var xa=wa._getInputValue();if(!t.test(xa))return true;var ya=wa._filesUploader;if(ya&&(ya.getAttachments().length>0||ya.getImageFiles().length>0||ya.getAnimatedImageFiles().length>0||ya.getVideoFiles().length>0||ya.getAudioFiles().length>0||ya.getFiles().length>0))return true;if(wa._sharePreview&&wa._sharePreview.component.getShareData())return true;return false;}function pa(wa){wa._nubController.flyoutContentChanged();var xa=wa._getNode('attachmentShelf');c('Scroll').setTop(xa,xa.scrollHeight);}function qa(wa,xa,ya){c('PhotosUploadWaterfall').sendSignal(babelHelpers['extends']({qn:wa._waterfallID,step:xa,uploader:c('PhotosUploadWaterfall').APP_CHAT},ya||{}));}function ra(wa,xa,ya,za,ab){if(xa)n.ensureThreadIsFetched(xa);this._threadID=wa;this._signatureID=ya;this._eventListeners=[];this._onlineStatus=c('AvailableListConstants').OFFLINE;this._tabTemplate=ia(wa);this._tabElem=this._tabTemplate.getRoot();if(ab&&ab.getTabElem()){this.insertBefore(ab);}else this.appendTo(za);this._messagesView=null;this._customColor=null;this._titlebar=this._getNode('nubFlyoutTitlebar');this._nubButton=c('DOMQuery').scry(this._tabElem,".fbNubButton")[0];this._pagesMessageIndicator=this._getNode('pagesMessageIndicator');this._waterfallID=c('WaterfallIDGenerator').generate();this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._canonicalGroupSearchSubscriptionID=null;this._initializeSheetController();var bb=[c('emptyFunction'),this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeTitleHREF.bind(this),this._initializeInput.bind(this),function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}.bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this),this._initializePageMessagingIndicator.bind(this),this._initializePagesGreeting.bind(this),this._initializeP2PChatThreadBannerContainer.bind(this)];for(var cb=bb,db=Array.isArray(cb),eb=0,cb=db?cb:cb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fb;if(db){if(eb>=cb.length)break;fb=cb[eb++];}else{eb=cb.next();if(eb.done)break;fb=eb.value;}var gb=fb;gb();}u.set(wa,this);this._logOpenTab();}function sa(wa){if(wa._photoUploader&&wa._photoUploader.isUploading())qa(wa,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD);}function ta(){for(var wa=u.values(),xa=Array.isArray(wa),ya=0,wa=xa?wa:wa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var za;if(xa){if(ya>=wa.length)break;za=wa[ya++];}else{ya=wa.next();if(ya.done)break;za=ya.value;}var ab=za;ab.updateAvailableStatus();ab.updateTitlebarTooltip();}}c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,function(){for(var wa=u.keys(),xa=Array.isArray(wa),ya=0,wa=xa?wa:wa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var za;if(xa){if(ya>=wa.length)break;za=wa[ya++];}else{ya=wa.next();if(ya.done)break;za=ya.value;}var ab=za;r.getThreadMeta(ab,function(bb){u.get(ab)._updateUnreadCount(bb);});}});k.addRetroactiveListener('state-changed',function(wa){for(var xa in wa){var ya=wa[xa]&&wa[xa].length,za=u.get(xa);za&&za.showTypingIndicator(ya);}});q.subscribe('threads-updated',function(wa,xa){for(var ya=u.keys(),za=Array.isArray(ya),ab=0,ya=za?ya:ya[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var bb;if(za){if(ab>=ya.length)break;bb=ya[ab++];}else{ab=ya.next();if(ab.done)break;bb=ab.value;}var cb=bb,db=u.get(cb);xa[cb]&&db.updateTab();if(db._newThreadIDFromPhotoUpload&&!db.isUploading()&&xa[db._newThreadIDFromPhotoUpload]){c('ChatTabActions').closeTab(db._threadID);c('ChatOpenTab').openThread(db._newThreadIDFromPhotoUpload,'ChatTabView');db._newThreadIDFromPhotoUpload=null;}}});q.subscribe('threads-deleted',function(wa,xa){for(var ya=u.keys(),za=Array.isArray(ya),ab=0,ya=za?ya:ya[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var bb;if(za){if(ab>=ya.length)break;bb=ya[ab++];}else{ab=ya.next();if(ab.done)break;bb=ab.value;}var cb=bb;xa[cb]&&c('ChatTabActions').closeTab(cb,'thread_deleted');if(r.isNewEmptyLocalThread(cb)){var db=u.get(cb);db.ensureValidCanonicalGroup(xa);}}});Object.assign(ra.prototype,{getThreadID:function(){return this._threadID;},getTabElem:function(){return this._tabElem;},showAddFriend:function(){setTimeout(function(){this._sheetController.openAddFriendsSheet();}.bind(this),0);},showNameConversation:function(wa){setTimeout(function(){this._sheetController.openNameConversationSheet(wa);}.bind(this),0);},hideAutomaticNameConversation:function(){setTimeout(function(){this._sheetController.closeAutomaticNameConversationSheet();}.bind(this),0);},isVisible:function(){return c('CSS').shown(this._tabElem);},isUploading:function(){var wa=this._composer&&this._composer.isUploading();return !!(wa||this._filesUploader&&this._filesUploader.isUploading()||this._sharePreview&&this._sharePreview.component.isLoading());},setVisibleState:function(wa,xa){var ya=c('CSS').shown(this._tabElem),za=c('CSS').hasClass(this._tabElem,'opened');c('CSS').conditionShow(this._tabElem,wa);c('CSS').conditionClass(this._tabElem,'opened',xa);if(!(ya&&za)&&wa&&xa){if(!this._messagesView)this._updateChatTabMessagesView(this._threadID);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();this.setP2PChatThreadBannerContainerVisibility();}},_updateChatTabMessagesView:function(wa){if(this._messagesView&&this._messagesView.getThreadID()===wa)return;var xa=c('MercuryIDs').tokenize(wa);this._messagesView&&this._messagesView.destroy();this._messagesView=new (c('ChatTabMessagesView'))(wa,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this,c('MercuryConfig').ShowContextBanner&&xa.type==='user');},focus:function(){if(c('CSS').hasClass(this._tabElem,'opened')){try{this._focusInput();}catch(wa){}}else this._getNode('dockButton').focus();},isFocused:function(){var wa=c('getActiveElement')();return c('Parent').bySelector(wa,"._50mz")===this._tabElem;},hasEmptyInput:function(){return t.test(this._getInputValue());},getInputElem:function(){return this._composer&&c('ReactDOM').findDOMNode(this._composer.getInput());},getMessagesView:function(){return this._messagesView;},loadShareFromParams:function(wa,xa){this._getSharePreview().done(function(ya){ya.setProps({share:{params:xa,type:wa},uri:null});});},_linkDropped:function(wa){this._getSharePreview().done(function(xa){xa.setProps({share:null,uri:wa});});},_filesDropped:function(wa){this._loadReactMenu().done(function(xa){var ya=xa.component.getFileUploaderPromise();if(ya)ya.done(function(za){setTimeout(function(){za.addDroppedFiles(wa);},0);});});},insertBefore:function(wa){c('DOM').insertBefore(wa.getTabElem(),this._tabElem);},appendTo:function(wa){c('DOM').appendContent(wa,this._tabElem);},nextTabIs:function(wa){var xa=wa&&wa.getTabElem();return this._tabElem.nextSibling==xa;},getScrollTop:function(){return c('Scroll').getTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(wa){c('Scroll').setTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'),wa);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();c('ReactDOM').unmountComponentAtNode(this._getNode('animationContainer'));c('ReactDOM').unmountComponentAtNode(this._getNode('menuContainer'));if(this._addToThreadButton){this._addToThreadButton.unmount();this._addToThreadButton=null;}if(this._archiveWarning){this._archiveWarning.unmount();this._archiveWarning=null;}if(this._videoCallButton){this._videoCallButton.unmount();this._videoCallButton=null;}if(this._voiceCallButton){this._voiceCallButton.unmount();this._voiceCallButton=null;}if(this._closeButton){this._closeButton.unmount();this._closeButton=null;}if(this._title){this._title.unmount();this._title=null;}if(this._sharePreview){this._sharePreview.unmount();this._sharePreview=null;}this._subscriptionsHandler&&this._subscriptionsHandler.release();c('ReactDOM').unmountComponentAtNode(this._getNode('name'));c('ReactDOM').unmountComponentAtNode(this._getNode('footer'));c('DOM').remove(this._tabElem);u['delete'](this._threadID);c('Dock').unregisterNubController(this._nubController);},updateAvailableStatus:function(){r.getThreadMeta(this._threadID,function(wa){var xa=c('AvailableListConstants').OFFLINE,ya=this._getCanonicalUserID(),za=null;if(ya){xa=c('PresenceStatus').get(ya);za=c('ShortProfiles').getNow(ya);}else{var ab=wa.participants.map(function(cb){return c('MercuryIDs').getUserIDFromParticipantID(cb);});xa=c('PresenceStatus').getGroup(ab);}if(!c('ChatVisibility').isOnline())xa=c('AvailableListConstants').OFFLINE;c('CSS').conditionClass(this._tabElem,"_5238",xa===c('AvailableListConstants').ACTIVE&&(za===undefined||za===null||!za.is_messenger_only));var bb=this._getNode('presenceIndicator');this._onlineStatus=xa;this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.notifyPageOnlineStatusChanged(xa);switch(xa){case c('AvailableListConstants').ACTIVE:bb.setAttribute('alt',j._("\u0412 \u0441\u0435\u0442\u0438"));break;default:bb.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){r.getThreadMeta(this._threadID,function(wa){var xa=[this._getNode('name')];if(this._title)this._title.setProps({thread:wa},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.component.getTitle());}.bind(this));for(var ya=xa,za=Array.isArray(ya),ab=0,ya=za?ya:ya[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var bb;if(za){if(ab>=ya.length)break;bb=ya[ab++];}else{ab=ya.next();if(ab.done)break;bb=ab.value;}var cb=bb;c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{isNewThread:r.isNewEmptyLocalThread(this._threadID),thread:wa,useAndSeparator:true,useShortName:!wa.is_canonical,viewer:c('CurrentUser').getID()}),cb);}this._updateControls(wa);this._updateMessageBlockSettings(wa);this._updateMessageManageSettings(wa);this._updateSecretModeSettings(wa);this._updateMutingSettings(wa);this._updateUnreadCount(wa);this.updateTitlebarTooltip();this._updateArchiveWarning(wa);this._updateConfidentialStatus(wa);this._updateEmployeeAwayWarning(wa);this._updateOfficeStatus(wa);this._updateNewThread(wa);this._updateNameConversationSheet(wa);this._updateReadOnlySheet(wa);this._updateSwitchToWork(wa);this._updateCustomLike(wa);}.bind(this));},_updateNameConversationSheet:function(wa){if(c('MercuryThreadInfo').canReply(wa)&&!wa.name&&!wa.is_canonical&&!wa.name_conversation_sheet_dismissed&&!wa.has_email_participant&&!wa.read_only&&!r.isEmptyLocalThread(wa.thread_id)&&!c('MercuryConfig').SuppressNamingUpsell){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(wa){var xa=c('MercuryThreadInfo').showComposer(wa),ya=c('MercuryThreadInfo').canReply(wa),za=r.isEmptyLocalThread(wa.thread_id);if(!ya&&!xa&&!za)this._sheetController.openReadOnlySheet();},_updateMessageManageSettings:function(wa){var xa=c('MercuryIDs').getParticipantIDFromFromThreadID(wa.thread_id),ya=xa?c('MercuryParticipants').getNow(xa):null;this._updateMenuPropsSafe({isBusinessEnabled:ya&&ya.is_business_enabled});},updateSignatureID:function(wa){this._signatureID=wa;},_updateMessageBlockSettings:function(wa){this._updateMenuPropsSafe({hasMessageBlocked:c('MercuryBlockedParticipants').get().isMessageBlocked(wa),isEmptyConversation:wa&&wa.message_count==0});},_updateCustomLike:function(wa){},_updateSecretModeSettings:function(wa){var xa=!!(wa&&wa.ephemeral_ttl_mode);this._updateMenuPropsSafe({hasSecretModeOn:xa});c('CSS').conditionClass(this._tabElem,"_5iq8",xa);var ya=xa?j._("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u0441\u0447\u0435\u0437\u0430\u044e\u0449\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435..."):j._("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435...");this._composer&&this._composer.setPlaceholder(ya);},_updateMutingSettings:function(wa){var xa=!!wa&&c('MercuryThreadInfo').isMuted(wa);xa&&!this._reactChatTabMenu&&this._loadReactMenu();this._updateMenuPropsSafe({isMuted:xa});},_updateMenuPropsSafe:function(wa){if(this._menuPromise)this._menuPromise.done(function(xa){xa&&xa.component&&xa.component.isMounted()&&xa.setProps(wa);});},_updateArchiveWarning:function(wa){if(c('CurrentUser').isEmployee())c('MercuryParticipants').getMulti(wa.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateConfidentialStatus:function(wa){if(wa.other_user_fbid)c('MercuryParticipants').getMulti(wa.participants,function(xa){var ya=this._getNode('titlebarConfidentialStatus');if(ya){var za=wa.other_user_fbid&&xa[c('MercuryIDs').getParticipantIDFromUserID(wa.other_user_fbid)].is_anonymous_crisis_support;c('CSS').conditionShow(ya,za);}}.bind(this));},_updateEmployeeAwayWarning:function(wa){if(!c('CurrentUser').isEmployee())return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatEmployeeAwayWarning"],function(xa){xa.updateEmployeeAwayWarning(wa,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),c('emptyFunction'));}.bind(this));}.bind(this));},_updateOfficeStatus:function(wa){var xa=this._getNode('officeStatus');if(!xa||c('MercuryIDs').isGroupChat(wa.thread_id))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatTabOfficeStatus"],function(ya){var za=c('MercuryIDs').getParticipantIDFromUserID(wa.other_user_fbid);c('MercuryParticipants').get(za,function(ab){ya.update(xa,ab);});});});},_updateSwitchToWork:function(wa){if(c('CurrentUser').isEmployee()&&c('CurrentUser').hasWorkUser()&&c('MercuryIDs').isGroupChat(wa.thread_id)){c('MercuryParticipants').getMulti(wa.participants,function(xa){var ya=this._isEmployeesOnly(xa);this._updateMenuPropsSafe({hasSwitchToWork:ya});}.bind(this));}else this._updateMenuPropsSafe({hasSwitchToWork:false});},_updateControls:function(wa,xa,ya){var za=this._isPageChat(),ab=c('MercuryThreadInfo').showComposer(wa)&&(!c('isEmpty')(wa.participants)||!!xa)&&!this._composerNullState,bb=this._getNode('footer');c('CSS').conditionShow(bb,ab);c('CSS').conditionShow(this._getNode('menuContainer'),ab);var cb={isEmptyChat:r.isNewEmptyLocalThread(wa.thread_id),show:ab};if(za)cb.showAddFriend=null;this._updateMenuPropsSafe(cb);var db=ab&&!za;this._addToThreadButton&&this._addToThreadButton.setProps({shown:db});if(ya&&ya.length===1&&c('MercuryConfig').ShowContextBanner&&c('MercuryConfig').ShowContextBannerNullState){this._messagesView&&this._messagesView.renderContextBanner(null,ya[0].info&&ya[0].info.uid);}else this._messagesView&&this._messagesView.unmountContextBanner();},_updateNewThread:function(wa){if(r.isNewEmptyLocalThread(wa.thread_id))this.showAddFriend();},_isEmployeesOnly:function(wa){for(var xa in wa)if(!wa[xa].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(wa){var xa=this._isEmployeesOnly(wa),ya=this._getNode('archiveContainer');if(ya){if(this._titlebarTooltipAnchor)c('CSS').conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',xa);c('CSS').conditionShow(ya,xa);this._archiveWarning&&this._archiveWarning.setProps({shown:xa});}},updateTitlebarTooltip:function(){r.getThreadMeta(this._threadID,function(wa){var xa=c('ReactDOM').findDOMNode(this._title.component);if(!xa)return;ca(xa,wa.participants);if(z&&this._customColor!==wa.custom_color&&!wa.ephemeral_ttl_mode){this._customColor=wa.custom_color;this._setCustomColor(this._titlebar,this._customColor);var ya=c('DOMQuery').scry(this._tabElem,"._560z");if(ya&&ya.length>0)this._setCustomColor(ya[0],this._customColor);}}.bind(this));},_getNode:function(wa){return this._tabTemplate.getNode(wa);},_getCanonicalUserID:function(){return c('MercuryIDs').getUserIDFromThreadID(this._threadID);},_listen:function(wa,event,xa,ya){var za=this._getNode(wa);if(za){this._eventListeners.push(c('Event').listen(za,event,xa.bind(this)));}else if(!ya)throw new Error('Could not find node "'+wa+'"');},_closePreClicked:function(wa){this._closeMouseDown=true;},_closeClicked:function(wa){sa(this);c('ChatTabActions').closeTab(this._threadID);if(wa instanceof c('SyntheticMouseEvent')){wa.stopPropagation();return;}wa.kill();},_closeEnter:function(wa){if(wa.keyCode===c('Keys').RETURN)this._closeClicked(wa);},_nubClicked:function(wa){wa.kill();return c('ChatTabViewEvents').inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE){c('ChatTabViewEvents').inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===c('Keys').ESC){this._handleEscape();event.kill();}else if(event.keyCode===c('Keys').TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var wa=c('ChatTabViewEvents').inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!wa&&event.preventDefault();}},_handleEscape:function(){sa(this);if(this.hasEmptyInput()){c('ChatTabViewEvents').inform('esc-pressed',this._threadID);}else{var wa=j._("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u043e\u043a\u043d\u043e \u044d\u0442\u043e\u0433\u043e \u0447\u0430\u0442\u0430?"),xa=j._("\u0412\u044b \u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435.");c('SimpleXUIDialog').showConfirm(wa,xa,function(ya){if(ya){c('ChatTabViewEvents').inform('esc-pressed',this._threadID);}else this.focus();}.bind(this),{autofocusConfirm:true,useReactFocusBehavior:true});}},_titleClicked:function(event){var wa=event.getTarget();if(!c('Parent').byClass(wa,'titlebarText')&&!c('Parent').byClass(wa,'uiSelector')&&!c('Parent').bySelector(wa,"._3olv")&&!c('Parent').byClass(wa,'close')){event.kill();c('ChatTabActions').lowerTab(this._threadID);this.focus();}},_addFriendLinkClicked:function(){this.showAddFriend();},_getUserParticipants:function(wa){var xa=[];wa.forEach(function(ya){var za=c('MercuryIDs').getUserIDFromParticipantID(ya);za&&xa.push(za);});return xa;},_enableDesktopNotif:function(){Notification.requestPermission();},_inputPasted:function(event){if(c('UserAgent_DEPRECATED').chrome()){var wa=event.clipboardData||event.originalEvent.clipboardData;if(!wa||!wa.items||wa.items.length<1)return;var xa=wa.items[0].type;if(xa!=='image/png')return;if(wa.items[0].getAsFile){var ya=wa.items[0].getAsFile();this._photoUploader&&this._photoUploader.uploadFiles([ya]);}}},_focusInput:function(){c('ChatNubLogger').processEvent('focus');this._composer?this._composer.getInput().focus():this._focusOnComposerMount=true;},_focusTab:function(){c('CSS').addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._closeMouseDown=false;this._setCloseTooltip(true);c('ChatTabViewEvents').inform('focus-tab',this._threadID);},_blurTab:function(){c('ChatNubLogger').processEvent('blur');c('CSS').removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(wa){if(this._closeButton){this._closeButton.setProps({active:wa});return;}var xa=this._getNode('titlebarCloseButton');if(!xa)return;var ya=wa?j._("\u041d\u0430\u0436\u043c\u0438\u0442\u0435 Esc \u0434\u043b\u044f \u0432\u044b\u0445\u043e\u0434\u0430"):j._("\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u043a\u043b\u0430\u0434\u043a\u0443");c('TooltipData').set(xa,ya,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===c('Keys').RETURN&&!event.shiftKey){if(na(this)){ma(this);event.kill&&event.kill();return;}ja(this);event.kill?event.kill():event.preventDefault();return;}if(event.keyCode===c('Keys').DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();c('ChatTabActions').lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_showMessageBlockedDialog:function(wa){var xa=this._getCanonicalUserID();if(!xa)return;var ya='fbid:'+xa;c('MercuryParticipants').get(ya,function(za){c('Bootloader').loadModules(["MessageBlockedDialog"],function(ab){ab.show(wa.thread_id,wa.can_reply,c('MercuryBlockedParticipants').get().isMessageBlocked(wa),za.short_name);});});},_initializeInput:function(){var wa=new (c('ReactComponentRenderer'))(c('ChatTabComposerContainer.react'),this._getNode('footer'));wa.setProps({initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onMount:function(xa){this._composer=xa;if(this._focusOnComposerMount){this._composer.getInput().focus();this._focusOnComposerMount=false;}}.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),resizeFn:function(){this._nubController.flyoutContentChanged();}.bind(this),placeholder:j._("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435..."),onCustomLikeSelect:this._customLikeSelected.bind(this),onEmojiSelect:this._emojiSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),onFileUploadFail:this._handleFileLastUploadFailed.bind(this),onP2PTrigger:this._p2pTriggered.bind(this),onPhotoUploadFail:this._handlePULastUploadFailed.bind(this),onStickerSelect:this._stickerSelected.bind(this),onUploadCancel:this._handlePULastUploadCanceled.bind(this),onUploadComplete:this._handlePUAllUploadsCompleted.bind(this),onUploadSubmit:this._handleUploadSubmit.bind(this),threadID:this._threadID,viewer:c('CurrentUser').getID()});},_initializeSharePreview:function(wa,xa){c('Event').listen(wa,'keyup',function(){var ya=xa?xa():wa.value;if(!ya.length)if(this._urlScraper){this._urlScraper.reset();delete this._urlScraperData;}}.bind(this));c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["URLScraper"],function(ya){this._urlScraper=new ya(wa,xa);this._urlScraper.subscribe('match',function(za,ab){this._urlScraperData=ab;this._getSharePreview().done(function(bb){var cb=this._urlScraperData;bb.setProps({share:null,uri:cb&&cb.url});}.bind(this));}.bind(this));}.bind(this));}.bind(this));},_getSharePreview:function(){if(!this._sharePreview&&!this._sharePreviewPromise){this._sharePreviewLoading=true;this._sharePreviewPromise=new (c('Promise'))(function(wa){c('Bootloader').loadModules(["MercurySharePreview.react"],function(xa){this._sharePreview=new (c('ReactComponentRenderer'))(xa,this._getNode('shareAttachmentShelf'));this._sharePreview.setProps({imageSize:{width:v,height:v},location:c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){pa(this);this._unblockSend();}.bind(this)});this._sharePreviewLoading=false;wa(this._sharePreview);}.bind(this));}.bind(this));}return this._sharePreviewPromise;},_initializeThingsWithInputFn:function(wa,xa){this._getValueFromReactComposer=xa;this._initializeSharePreview(wa,xa);r.getThreadMeta(this._threadID,function(ya){if(ya){if(ya.folder===c('MessagingTag').PENDING){var za=c('DOM').create('div');c('DOM').appendContent(this._getNode('chatConv'),za);this._composerNullState=za;c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:27}}),bootloadLoader:c('JSResource')('ChatPendingActions.react'),onDeleteClick:function(cb){o.changeFolder(this._threadID,c('MessagingTag').OTHER);c('ChatTabActions').closeTab(this._threadID);}.bind(this),onReplyClick:function(cb){o.changeFolder(this._threadID,c('MessagingTag').INBOX);c('DOM').remove(za);delete this._composerNullState;this._updateControls(ya);this._nubController.flyoutContentChanged();}.bind(this)}),za);}if(aa&&this._isPageChat()){var ab=this._getPageID(),bb=c('XMNCommercePageNullStateCTAController').getURIBuilder();new (c('AsyncRequest'))().setURI(bb.getURI()).setMethod('POST').setData({page_id:ab}).setHandler(function(cb){if(cb&&cb.payload){var db=c('DOM').create('div');this._composerNullState=db;var eb=cb.payload;c('DOM').appendContent(this._getNode('chatConv'),db);this._composerNullState=db;c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:27}}),bootloadLoader:c('JSResource')('ChatPageComposerNullState.react'),title:eb.title,onClick:function(fb){c('MNCommercePostbackCTADataManager').send(eb.id);c('DOM').remove(db);delete this._composerNullState;this._updateControls(ya);this._nubController.flyoutContentChanged();}.bind(this)}),db);this._updateControls(ya);this._nubController.flyoutContentChanged();}}.bind(this)).send();}}p.getServerIDFromClientID(this._threadID,function(cb){this._typingDetector=new (c('TypingDetectorController'))(this._getCanonicalUserID(),wa,'mercury-chat',null,cb,xa);}.bind(this));}.bind(this));},_getInputValue:function(){if(this._getValueFromReactComposer)return this._getValueFromReactComposer();if(!this._chatInput||!this._chatInput.component.isMounted())return '';return this._chatInput.component.getValue()||'';},appendTextToInput:function(wa){this._composer&&this._composer.getInput().appendText(wa);},_hasUnfinishedPost:function(){return oa(this)||this.isUploading();},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){o.markRead(this._threadID);o.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(wa){this.tryMarkAsRead();if(c('Parent').byTag(wa.getTarget(),'a')||c('DOM').getSelection())return;this.focus();},_inputContainerClicked:function(wa){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function(){if(!this._pagesMessageIndicator)return;c('CSS').hide(this._pagesMessageIndicator);this._pagesMessageIndicatorHandler=c('PagesMercuryChatTabIndicatorHandler').tryCreateHandler(this._threadID,this._pagesMessageIndicator,this._onlineStatus);this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.checkResponsiveness();},_initializePagesGreeting:function(){var wa=c('DOMQuery').scry(this._tabElem,"._av1"),xa=this._threadID,ya=c('MercuryIDs').getUserIDFromThreadID(xa);if(!wa||wa.length===0)return;if(c('FBID').isUser(ya)){c('CSS').hide(wa[0]);return;}var za=c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MercuryChatTabPagesGreetingContainer.react'),threadID:xa});c('ReactDOM').render(za,wa[0]);},showTypingIndicator:function(wa){this._renderTypingIndicator();c('CSS').conditionClass(this._tabElem,"_54m8",wa);},_renderTypingIndicator:function(){var wa=c('CSS').hasClass(this._tabElem,'highlightTab')?'light':'dark';c('ReactDOM').render(c('React').createElement(c('MercuryTypingAnimation.react'),{color:wa}),this._getNode('animationContainer'));},_updateUnreadCount:function(wa){var xa=wa.unread_count;if(typeof xa!='undefined'){var ya=!!xa&&(!c('ChatBehavior').showsTabUnreadUI||c('ChatBehavior').showsTabUnreadUI()),za=this._getNode('numMessages');c('CSS').conditionShow(za,ya);c('CSS').conditionClass(this._tabElem,'highlightTab',ya);this._renderTypingIndicator();ga(this._threadID,this._tabElem,ya);c('DOM').setContent(za,xa);this._setCustomColor(this._nubButton,ya?this._customColor:null);}},ensureValidCanonicalGroup:function(wa){if(this._messagesView&&this._messagesView.getThreadID()===this._threadID)return;if(wa[this._messagesView.getThreadID()])this._updateChatTabMessagesView(this._threadID);},_initializeSheetController:function(){this._sheetController=new (c('ChatTabSheetController'))(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickMessagesBlockedSheet(function(){o.unblockMessages(this._threadID);this.focus();}.bind(this));this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){o.unmute(this._threadID);this.focus();}.bind(this));this._sheetController.onClickSecretModeSheet(function(){o.turnOffSecretMode(this._threadID);this.focus();}.bind(this));this._sheetController.onTokensChanged(function(wa,xa){this._handleSheetControllerTokensChanged(xa);}.bind(this));this._nubController=new (c('NubController'))().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));},_handleSheetControllerTokensChanged:function(wa){this._updateComposerParticipants(wa.tokens);r.getThreadMeta(this._threadID,function(xa){this._updateControls(xa,wa.token_count,wa.tokens);}.bind(this));this._updateMessagesViewIfNecessary(wa);},_updateMessagesViewIfNecessary:function(wa){if(!c('MercuryConfig').MessengerChatTabSnapCanonialGK||!r.isEmptyLocalThread(this._threadID))return;var xa=c('MercuryCanonicalGroupThreadManager').get();xa.unsubscribe(this._canonicalGroupSearchSubscriptionID);if(wa.token_count===1){var ya=wa.tokens[0].info&&wa.tokens[0].info.uid;this._updateMercuryMessagesViewCanonical(c('MercuryIDs').getThreadIDFromUserID(ya));return;}this._updateMercuryMessagesViewCanonical(this._threadID);if(wa.token_count>1){var za=wa.tokens.map(function(ab){return ab.info.uid;});this._canonicalGroupSearchSubscriptionID=xa.getCanonicalGroupThreadIDForParticipants(Array.from(za),this._updateMercuryMessagesViewCanonical.bind(this));}},_updateMercuryMessagesViewCanonical:function(wa){if(wa){this._updateChatTabMessagesView(wa);this._messagesView.scrollToBottom();}},_updateComposerParticipants:function(wa){var xa=void 0;if(wa&&wa.length===1&&wa[0].info&&wa[0].info.uid)xa=[c('MercuryIDs').getParticipantIDFromUserID(wa[0].info.uid)];this._composer&&this._composer.setParticipantIDs(xa);},_initializeHeader:function(){this._initializeTitle();this._initializeCloseButton();this._initializeReactMenu();this._initializeAddToThreadButton();this._initializeRTC();this._initializeArchiveWarning();},_loadReactMenu:function(){var wa=c('MercuryIDs').isGroupChat(this._threadID),xa=r.isNewEmptyLocalThread(this._threadID),ya=this._sheetController.openAddFriendsSheet.bind(this._sheetController);c('JSResource')('ChatTabMenu.react').load().done(function(za){this._reactChatTabMenu=new (c('ReactComponentRenderer'))(za,this._getNode('menuContainer'));this._reactChatTabMenu.setProps({sheetController:this._sheetController,onFileUploaderMounted:this.setFilesUploader.bind(this),nameConversationFunc:function(){return this.showNameConversation();}.bind(this),isGroupChat:wa,isEmptyChat:xa,showAddFriend:ya,threadID:this._threadID,otherUserID:this._getCanonicalUserID(),attachmentsShelf:this._getNode('fileAttachmentShelf'),onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:function(){return pa(this);}.bind(this),onSubmit:this._focusInput.bind(this)},function(){this._menuPromiseResolve(this._reactChatTabMenu);}.bind(this));}.bind(this));return this._menuPromise;},_initializeReactMenu:function(){this._menuPromise=new (c('Promise'))(function(wa){this._menuPromiseResolve=wa;}.bind(this));this._listen('menuButton','click',function(wa){wa.preventDefault();this._loadReactMenu().done(function(xa){xa.component.open();});}.bind(this));},_initializeArchiveWarning:function(){var wa=this._getNode('archiveContainer');if(!wa)return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ArchiveWarning.react"],function(xa){this._archiveWarning=new (c('ReactComponentRenderer'))(xa,wa);this._archiveWarning.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,shown:true});}.bind(this));}.bind(this));},_initializeAddToThreadButton:function(){c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatAddToThreadButton.react"],function(wa){this._addToThreadButton=new (c('ReactComponentRenderer'))(wa,this._getNode('addToThreadContainer'));this._addToThreadButton.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,onClick:this._addFriendLinkClicked.bind(this),shown:true});}.bind(this));}.bind(this));},_initializeRTC:function(){var wa=c('MercuryIDs').isGroupChat(this._threadID);if(wa&&!c('ChatConfig').get('rtc_conferencing_www'))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatVideoCallButton.react"],function(xa){var ya=c('CurrentUser').getID();this._videoCallButton=new (c('ReactComponentRenderer'))(xa,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({isAudio:false,isGroupChat:wa,threadID:this._threadID,viewer:ya});this._voiceCallButton=new (c('ReactComponentRenderer'))(xa,this._getNode('voiceCallButtonContainer'));this._voiceCallButton.setProps({isAudio:true,isGroupChat:wa,threadID:this._threadID,viewer:ya});}.bind(this));}.bind(this));},_initializeCloseButton:function(){this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatCloseButton.react"],function(wa){this._closeButton=new (c('ReactComponentRenderer'))(wa,this._getNode('titlebarCloseButtonContainer'));this._closeButton.setProps({active:this.isFocused(),className:"_3olu _3olv",onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)});}.bind(this));}.bind(this));},_initializeTitle:function(){var wa=r.getThreadMetaNow(this._threadID);this._title=new (c('ReactComponentRenderer'))(c('ChatTitleLink.react'),this._getNode('titleContainer'));this._title.setProps({thread:wa,viewer:c('CurrentUser').getID()});},_initializeTitleHREF:function(){var wa=this._getCanonicalUserID();if(wa){c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(wa),function(xa){if(xa.href){this._setTitleHref(xa.href);}else{var ya=c('WebMessengerThreadPermalinks').getThreadURIFromUserID(wa);this._setTitleHref(ya);}}.bind(this));}else c('WebMessengerThreadPermalinks').getThreadURI(this._threadID,function(xa){return this._setTitleHref(xa);}.bind(this));this._titlebarTooltipAnchor=this._getNode('titlebarText');},_initializeUIListeners:function(){if(this._pagesMessageIndicator)this._listen('scrollingArea','scroll',function(event){var wa=event.target;if(wa.scrollHeight-wa.offsetHeight!==wa.scrollTop)this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.hideIndicatorAndPreventFutureShow();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);if(this._getNode('inputContainer'))this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===c('Keys').TAB){this._focusInput();event.kill();}if(event.keyCode===c('Keys').ESC)this._handleEscape();}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFilesUploader:function(wa){this._filesUploader=wa;},_initializeDragDropTarget:function(){if(c('WorkFileUploadsGating').canUploadFiles){var wa=c('DOMQuery').scry(this._tabElem,"._1ia");if(wa&&wa.length>0){this._dropTarget=new (c('DragDropTarget'))(wa[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}}},_initializeP2PChatThreadBannerContainer:function(){var wa=c('DOMQuery').scry(this._tabElem,"._2hc2");if(wa&&wa.length>0){this._p2pChatThreadBannerContainerEl=wa[0];c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["P2PChatThreadBannerContainer.react"],function(xa){this._p2pChatThreadBannerContainer=new (c('ReactComponentRenderer'))(xa,this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable(),otherUserID:c('MercuryIDs').getUserIDFromThreadID(this._threadID),threadID:this._threadID});}.bind(this));}.bind(this));}},setP2PChatThreadBannerContainerVisibility:function(){if(this._p2pChatThreadBannerContainer)this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable()});},isChatViewable:function(){return (this._tabElem&&c('CSS').hasClass(this._tabElem,'opened')&&!c('CSS').hasClass(this._tabElem,'hidden_elem'));},_initializeUnloadListeners:function(){this._checkUnsentMessages=c('createCancelableFunction')(function(){if(this._hasUnfinishedPost())return j._("\u0412\u044b \u0435\u0449\u0435 \u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u0425\u043e\u0442\u0438\u0442\u0435 \u0432\u044b\u0439\u0442\u0438, \u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0432 \u0435\u0433\u043e?");if(m.getNumberLocalMessages(this._threadID))return j._("\u0412\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432\u0441\u0435 \u0435\u0449\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443?");return null;}.bind(this));c('Run').onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=c('createCancelableFunction')(sa.bind(null,this));c('Run').onUnload(this._logUnsentPhotos);},_handleUploadSubmit:function(wa){qa(this,c('PhotosUploadWaterfall').UPLOAD_START,wa);la(this,'',[],function(xa){if(this._threadID!==xa.thread_id){this._newThreadIDFromPhotoUpload=xa.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(xa.thread_id);}xa.content_attachment=null;s.addAttachmentPlaceholder(xa,wa.upload_id,wa);}.bind(this));ua('submit',wa);this._focusInput();},_handleFileLastUploadFailed:function(wa){qa(this,c('PhotosUploadWaterfall').CLIENT_ERROR,wa);ua('failed',wa);},_handlePULastUploadFailed:function(wa){qa(this,c('PhotosUploadWaterfall').CLIENT_ERROR,wa);ua('failed',wa);},_handlePULastUploadCanceled:function(wa){qa(this,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD,wa);ua('canceled',wa);},_handlePUAllUploadsCompleted:function(wa){qa(this,c('PhotosUploadWaterfall').ALL_UPLOADS_DONE,wa);ua('completed',wa);var xa=wa.image_ids.length||wa.attachments.length;ka(this,xa);},_stickerSelected:function(wa){la(this,'',[],function(xa){xa.has_attachment=true;xa.sticker_id=wa;s.send(xa);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emojiSelected:function(wa){this._composer&&this._composer.getInput().insertEmoji(wa);},_customLikeSelected:function(wa,xa){la(this,wa.emoji,[],function(ya){ya.has_attachment=false;s.send(c('EmojiLikeUtils').setEmojiSize(ya,xa));this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(wa){var xa=c('EmoticonsList').symbols[wa];if(!xa)return;this._composer&&this._composer.getInput().insertEmoticon(xa);},_p2pTriggered:function(){la(this,'',[],function(wa){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_setTitleHref:function(wa){this._title&&this._title.setProps({href:wa});},_unblockSend:function(){if(!this._blocked||na(this))return;this._blocked=false;ja(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new (c('AsyncSignal'))('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();},_setCustomColor:function(wa,xa){if(!wa)return;if(xa){c('Style').apply(wa,{backgroundColor:xa,borderColor:xa});}else if(wa.style){wa.style.backgroundColor='';wa.style.borderColor='';}c('CSS').conditionClass(wa,"_1m34",!!xa);},_isPageChat:function(){if(this._threadID){var wa=c('MercuryIDs').tokenize(this._threadID);if(wa.type==='user')return !c('FBID').isUser(wa.value);}return false;},_getPageID:function(){if(this._threadID){var wa=c('MercuryIDs').tokenize(this._threadID);if(wa.type==='user'&&!c('FBID').isUser(wa.value))return wa.value;}return null;}});function ua(wa,xa){ba.debug('photo_uploader:'+wa,'{}');}function va(wa,xa){if(!xa)return wa;var ya=xa.getImageFiles();if(ya.length>0){wa.image_ids=ya;wa.has_attachment=true;}var za=xa.getAnimatedImageFiles();if(za.length>0){wa.gif_ids=za;wa.has_attachment=true;}var ab=xa.getVideoFiles();if(ab.length>0){wa.video_ids=ab;wa.has_attachment=true;}var bb=xa.getAudioFiles();if(bb.length>0){wa.audio_ids=bb;wa.has_attachment=true;}var cb=xa.getFiles();if(cb.length>0){wa.file_ids=cb;wa.has_attachment=true;}return wa;}f.exports=ra;},null);